const h="https://nomanssky.fandom.com/api.php",u=e=>{const n=new URLSearchParams;return Object.entries(e).forEach((([e,i])=>{n.append(e,i.toString())})),`${h}?${n.toString()}`},p={format:"json",origin:"*"},R=(e,n,i)=>{const r={...p,action:"cargoquery",tables:"Bases",fields:["Name","CensusPlayer","CensusReddit","CensusDiscord","CensusFriend","System","Platform","Mode","CensusArrival","CensusRenewal","Builderlink"].join(","),where:`CensusShow IS NOT NULL AND Civilized='${e}'${i?` AND CensusRenewal HOLDS ${i}`:""}`,order_by:"CensusRenewal DESC",group_by:"CensusPlayer",limit:500,offset:n};return u(r)},g=async e=>{try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.text(),r=b(i);return JSON.parse(r)}catch(e){throw console.error("API call failed:",e),e}},b=e=>e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&amp;/g,"&"),q=e=>e.cargoquery.map((({title:e})=>({Name:e.Name,_pageName:e._pageName||e.Name,CensusPlayer:e.CensusPlayer||"Desconocido",System:e.System||"Desconocido",Platform:e.Platform||"Desconocida",Mode:e.Mode||"Desconocido",CensusArrival:e.CensusArrival||"Desconocido",CensusRenewal:e.CensusRenewal||"Desconocido",Builderlink:e.Builderlink,CensusReddit:e.CensusReddit,CensusDiscord:e.CensusDiscord,CensusFriend:e.CensusFriend,CensusVerified:e.CensusVerified}))),v=async(e,n,i)=>{const r=R(e,n,i),o=await g(r);if(null==o||!o.cargoquery)throw new Error("Invalid API response structure");return q(o)},x=async e=>{var n,i;const r={...p,action:"parse",page:e,prop:"wikitext"},o=u(r),s=await g(o),t=((null==(i=null==(n=null==s?void 0:s.parse)?void 0:n.wikitext)?void 0:i["*"])||"").match(/\|\s*image\s*=\s*(.+)/i);return t?t[1].split("\n")[0].split("|")[0].trim():null},S=async e=>{var n;e.toLowerCase().startsWith("file:")||(e="File:"+e);const i={...p,action:"query",titles:e,prop:"imageinfo",iiprop:"url"},r=u(i),o=await g(r),s=null==(n=null==o?void 0:o.query)?void 0:n.pages;if(s){const e=s[Object.keys(s)[0]];if(e&&e.imageinfo&&e.imageinfo[0]){const n=e.imageinfo[0].url;return{panel:n.split("/revision")[0],modal:n.split("revision")[0]}}}return null},O=async e=>{const n=await x(e);return n?await S(n):null},U=(e,n=0)=>{const i={...p,action:"cargoquery",tables:"Regions",fields:["Regions.Coordinates","Regions.Galaxy","Regions.Quadrant","Regions.Civilized","_pageName=Region"].join(","),where:`Civilized='${e}'`,order_by:"Region ASC",offset:n};return u(i)},N=e=>e.cargoquery.map((({title:e})=>({Coordinates:e.Coordinates||"Desconocido",Galaxy:e.Galaxy||"Desconocido",Quadrant:e.Quadrant||"Desconocido",Civilized:e.Civilized||"Desconocido",Region:e.Region||"Desconocido"}))),j=async(e,n=0)=>{const i=U(e,n),r=await g(i);if(null==r||!r.cargoquery)throw new Error("Invalid API response structure");return N(r)},P=async e=>{var n,i;const r={...p,action:"parse",page:e,prop:"wikitext"},o=u(r),s=await g(o),t=((null==(i=null==(n=null==s?void 0:s.parse)?void 0:n.wikitext)?void 0:i["*"])||"").match(/\|\s*image\s*=\s*(.+)/i);return t?t[1].split("\n")[0].split("|")[0].trim():null},k=async e=>{var n;e.toLowerCase().startsWith("file:")||(e="File:"+e);const i={...p,action:"query",titles:e,prop:"imageinfo",iiprop:"url"},r=u(i),o=await g(r),s=null==(n=null==o?void 0:o.query)?void 0:n.pages;if(s){const e=s[Object.keys(s)[0]];if(e&&e.imageinfo&&e.imageinfo[0]){const n=e.imageinfo[0].url;return{panel:n.split("/revision")[0],modal:n.split("revision")[0]}}}return null},A=async e=>{const n=await P(e);return n?await k(n):null},I=async e=>{var n,i,r,o;const s={...p,action:"parse",page:e,prop:"text"},t=u(s),a=await g(t),l=(null==(i=null==(n=null==a?void 0:a.parse)?void 0:n.text)?void 0:i["*"])||"",c=(new DOMParser).parseFromString(l,"text/html").querySelector("table.article-table");if(!c)return null;const d={},m=Array.from(c.querySelectorAll("tr")).slice(2);for(const e of m){const n=Array.from(e.querySelectorAll("td"));if(n.length<6)continue;d[(null==(r=n[0].textContent)?void 0:r.trim().replace(/\[\[|\]\]/g,""))??"Unknown"]={CrossPlatform:parseInt((null==(o=n[5].textContent)?void 0:o.trim())??"0",10)}}return d};export{O as a,j as b,A as c,v as f,I as g};
