import{F as e,I as t,N as n,P as r,S as i,at as a,b as o,dt as s,f as c,g as l,h as u,ht as d,m as ee,mt as te,p as f,q as p,t as ne,u as m,y as h}from"./runtime-dom.esm-bundler-B0omDyfX.js";import{t as g}from"./button-RKJIGzvd.js";import{t as re}from"./ThemeSwitch-OryM05i3.js";import"./baseinput-CZKnC-4G.js";import{t as ie}from"./dialog-Ci4f1quW.js";import{t as _}from"./_plugin-vue_export-helper-B-x99n_9.js";import{t as v}from"./card-C6b-8PfK.js";import{t as ae}from"./panel-BN68OP1F.js";import{t as y}from"./logo-white-CmB7GzSq.js";import{t as oe}from"./tag-pUSeKvM8.js";import{t as se}from"./inputnumber-B4TZ75Gu.js";import{a as ce}from"./api-lfChQBpo.js";var le={class:`space-page-container`},ue={class:`flex items-start justify-between mb-6 header-container`},de={class:`flex flex-col`},b={class:`text-stellar-gray mt-2`},x={class:`mb-4 flex items-center gap-2`},S={class:`panel-content`},C={class:`update-info`},w={key:0,class:`loading-message`},T={key:1,class:`error-message p-error`},E={class:`p-4`},D={class:`flex flex-column gap-3`},O={class:`flex align-items-center gap-2`},k={class:`update-title`},A={class:`flex justify-between items-center mb-3`},j={class:`update-date`},M={class:`update-date-formatted`},N={key:0,class:`image-container`},P=[`src`,`alt`],F={class:`update-details`},I={class:`detail-item`},L={class:`detail-value`},R={key:0,class:`summary-box`},z={key:1,class:`fixes-box`},B={class:`fixes-preview`},V={class:`fix-text`},H={key:0,class:`fixes-actions`},fe={class:`dialog-content`},pe={class:`fixes-count`},me={class:`fixes-list-container`},he={class:`fix-number`},ge={class:`fix-content`},_e={class:`dialog-footer`},ve={class:`mt-3 flex justify-between`},ye=[`href`],be=[`href`],U=_(i({__name:`LatestUpdates`,setup(i){let _=c(()=>q.value.slice(0,K.value)),y=a({}),U=a(!0),W=a(null),G=a(window.innerWidth),K=a(10),q=a([]),J=a(!1),Y=a({}),xe=c(()=>G.value<768?1:G.value<1200?2:3),X=async()=>{try{let e=new URLSearchParams({action:`parse`,page:`Noticias`,prop:`text`,format:`json`,origin:`*`}),t=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${e.toString()}`)).json()).parse.text[`*`];Se(t)}catch(e){W.value=`Error al cargar las noticias`,console.error(e)}},Se=e=>{let t=new DOMParser,n=t.parseFromString(e,`text/html`).querySelector(`.plainlinks`);if(!n)return;let r=[],i=n.innerHTML.split(`<br>`);for(let e of i){if(!e.trim())continue;let n=t.parseFromString(e,`text/html`),i=n.querySelector(`a`);if(i){let e=i.textContent?.trim()||``,t=i.getAttribute(`href`)||``,a=decodeURIComponent(t.split(`/wiki/`).pop()||``).replace(/_/g,` `).match(/(\d+\.\d+(\.\d+)?)/),o=n.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);a&&o&&r.push({title:e,link:`https://nomanssky.fandom.com${t}`,date:o[1],version:a[1]})}}q.value=r,Ce()},Ce=async()=>{try{for(let e of _.value){let t=await we(e.link);t&&(y.value[e.version]=t)}}catch(e){console.error(`Error fetching update details:`,e)}finally{U.value=!1}},we=async e=>{try{let t=e.split(`/wiki/`)[1],n=new URLSearchParams({action:`parse`,page:decodeURIComponent(t),prop:`wikitext`,format:`json`,origin:`*`}),r=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${n.toString()}`)).json()).parse.wikitext[`*`];return Z(r,t)}catch(t){return console.error(`Error fetching details for ${e}:`,t),{}}},Te=e=>(e=e.replace(/'''/g,``),e=e.replace(/''/g,``),e=e.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,`$2`),e=e.replace(/\[\[([^\]]+)\]\]/g,`$1`),e=e.replace(/<br\s*\/?>/gi,`
`),e),Z=async(e,t)=>{let n={fixes:[]},r=e.match(/\|\s*image\s*=\s*(.+?)\n/);if(r){let e=await ce(r[1].split(`
`)[0].split(`|`)[0].trim());e&&(n.image=e)}let i=e.match(/\|\s*date\s*=\s*(.+?)\n/);i&&(n.date=i[1].trim());let a=e.match(/\|\s*platform\s*=\s*(.+?)\n/);a&&(n.platforms=a[1].trim());let o=e.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);o&&(n.link=o[1].trim());let s=e.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);s&&(n.summary=Te(s[1].trim()));let c=e.match(/==\s*(?:corre(?:cci[oó]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(c){let e=c[1].matchAll(/^\*\s*(.+)$/gm);for(let t of e){let e=t[1].replace(/\s+/g,` `).trim();n.fixes?.push(e)}}return n};n(()=>{window.addEventListener(`resize`,()=>G.value=window.innerWidth),X()});let Ee=()=>{U.value=!0,W.value=null,q.value=[],y.value={},X()},Q=e=>{let t={enero:`01`,febrero:`02`,marzo:`03`,abril:`04`,mayo:`05`,junio:`06`,julio:`07`,agosto:`08`,septiembre:`09`,octubre:`10`,noviembre:`11`,diciembre:`12`},n=e.split(` de `);return n.length===3?`${n[0].padStart(2,`0`)}/${t[n[1].toLowerCase()]}/${n[2]}`:e},De=c(()=>_.value.length>0?Q(_.value[0].date):`N/A`),$=()=>{J.value=window.scrollY>300},Oe=()=>{window.scrollTo({top:0,behavior:`smooth`})};n(()=>{window.addEventListener(`scroll`,$)}),r(()=>{window.removeEventListener(`scroll`,$)});let ke=e=>{Y.value[e]=!0},Ae=e=>{Y.value[e]=!1};return(n,r)=>(e(),l(m,null,[o(s(v),{class:`p-0 galactic-card`},{content:p(()=>[f(`div`,le,[f(`div`,ue,[f(`div`,de,[r[1]||=f(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[f(`div`,{class:`wiki-logo`},[f(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`Wiki Logo`})])],-1),r[2]||=f(`div`,{class:`header-container`},[f(`div`,{class:`title-theme-container`},[f(`h1`,{class:`galactic-title`},[f(`span`,{class:`title-text`},`Actualizaciones de No Man's Sky`)])])],-1),r[3]||=f(`p`,{class:`text-stellar-gray mt-2`},`Últimas actualizaciones del juego desde la wiki oficial`,-1),f(`p`,b,[o(re,{style:{"margin-right":`2rem`}})])])]),f(`div`,x,[r[4]||=f(`label`,{for:`maxUpdates`,class:`text-stellar-gray font-semibold`},`Mostrar hasta:`,-1),o(s(se),{id:`maxUpdates`,modelValue:K.value,"onUpdate:modelValue":r[0]||=e=>K.value=e,min:1,max:15,showButtons:!0,inputClass:`p-inputtext-sm`,class:`mx-2`},null,8,[`modelValue`]),r[5]||=f(`span`,{class:`text-stellar-gray`},`actualizaciones`,-1),r[6]||=f(`br`,null,null,-1),r[7]||=f(`br`,null,null,-1),o(s(g),{label:`Buscar Actualizaciones`,icon:`pi pi-refresh`,class:`p-button-outlined p-button-sm`,onClick:Ee})]),o(s(ae),{class:`galactic-panel`},{header:p(()=>[...r[8]||=[f(`h2`,{class:`panel-title`},`Historial de Actualizaciones`,-1)]]),default:p(()=>[f(`div`,S,[f(`p`,null,[r[9]||=h(` Total de actualizaciones recientes: `,-1),f(`strong`,null,d(_.value.length),1)]),f(`p`,C,`Última actualización: `+d(De.value),1)])]),_:1}),r[19]||=f(`br`,null,null,-1),U.value?(e(),l(`div`,w,[...r[10]||=[f(`i`,{class:`pi pi-spinner pi-spin`},null,-1),h(` Cargando actualizaciones... `,-1)]])):W.value?(e(),l(`div`,T,[r[11]||=f(`i`,{class:`pi pi-exclamation-triangle`},null,-1),h(` `+d(W.value),1)])):(e(),l(`div`,{key:2,class:`grid gap-4`,style:te(`grid-template-columns: repeat(${xe.value}, 1fr)`)},[(e(!0),l(m,null,t(_.value,(n,i)=>(e(),ee(s(v),{key:i,class:`update-card`},{content:p(()=>[f(`div`,E,[f(`div`,D,[f(`div`,O,[f(`h3`,k,d(n.title),1),o(s(oe),{value:n.version,severity:`info`,class:`version-tag`},null,8,[`value`])]),f(`div`,A,[f(`span`,j,d(n.date),1),f(`span`,M,d(Q(n.date)),1)]),y.value[n.version]?.image?(e(),l(`div`,N,[f(`img`,{src:y.value[n.version]?.image?.panel,alt:n.title,class:`update-image`},null,8,P)])):u(``,!0),f(`div`,F,[f(`div`,I,[r[12]||=f(`span`,{class:`detail-label`},`Plataformas:`,-1),f(`span`,L,d(y.value[n.version]?.platforms||`Todas`),1)]),y.value[n.version]?.summary?(e(),l(`div`,R,[r[13]||=f(`span`,{class:`detail-label`},`Resumen:`,-1),f(`p`,null,d(y.value[n.version]?.summary),1)])):u(``,!0),y.value[n.version]?.fixes&&y.value[n.version]?.fixes.length>0?(e(),l(`div`,z,[r[16]||=f(`div`,{class:`fixes-header`},[f(`i`,{class:`pi pi-wrench fixes-icon`}),f(`span`,{class:`detail-label`},`Correcciones principales:`)],-1),f(`div`,B,[(e(!0),l(m,null,t(y.value[n.version]?.fixes?.slice(0,3),(t,n)=>(e(),l(`div`,{key:n,class:`fix-item`},[r[14]||=f(`div`,{class:`fix-bullet`},null,-1),f(`span`,V,d(t),1)]))),128))]),y.value[n.version]?.fixes.length>3?(e(),l(`div`,H,[o(s(g),{label:`Ver todas (${y.value[n.version]?.fixes.length})`,icon:`pi pi-list`,class:`p-button-text p-button-sm view-all-btn`,onClick:e=>ke(n.version)},null,8,[`label`,`onClick`])])):u(``,!0),o(s(ie),{visible:Y.value[n.version],"onUpdate:visible":e=>Y.value[n.version]=e,header:`Correcciones completas - Versión ${n.version}`,modal:``,closable:!1,dismissableMask:``,class:`fixes-dialog`,style:{width:`90vw`,maxWidth:`800px`}},{footer:p(()=>[f(`div`,_e,[o(s(g),{label:`Cerrar`,icon:`pi pi-times`,class:`p-button-outlined`,onClick:e=>Ae(n.version)},null,8,[`onClick`])])]),default:p(()=>[f(`div`,fe,[f(`div`,pe,[r[15]||=f(`i`,{class:`pi pi-info-circle`},null,-1),f(`span`,null,`Total de correcciones: `+d(y.value[n.version]?.fixes?.length),1)]),f(`div`,me,[(e(!0),l(m,null,t(y.value[n.version]?.fixes,(t,n)=>(e(),l(`div`,{key:n,class:`dialog-fix-item`},[f(`div`,he,d(n+1),1),f(`div`,ge,d(t),1)]))),128))])])]),_:2},1032,[`visible`,`onUpdate:visible`,`header`])])):u(``,!0),f(`div`,ve,[f(`a`,{href:n.link,target:`_blank`,class:`wiki-link`},[...r[17]||=[f(`i`,{class:`pi pi-book`},null,-1),h(` Ver en wiki `,-1)]],8,ye),y.value[n.version]?.link?(e(),l(`a`,{key:0,href:y.value[n.version]?.link,target:`_blank`,class:`official-link`},[...r[18]||=[f(`i`,{class:`pi pi-globe`},null,-1),h(` Nota oficial `,-1)]],8,be)):u(``,!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),o(ne,{name:`fade`},{default:p(()=>[J.value?(e(),l(`button`,{key:0,onClick:Oe,class:`scroll-top-button`},[...r[20]||=[f(`i`,{class:`pi pi-arrow-up`},null,-1)]])):u(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-5f0dda4a`]]);export{U as default};