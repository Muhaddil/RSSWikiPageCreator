import{_ as $,s as C}from"./index-DLhGNzuu.js";import{s as I}from"./index-Clheav9c.js";import{s as B}from"./index-wZj6rrNL.js";import{d as L,r as _,c as U,a2 as E,j as x,o as d,k as v,b as s,f as g,a as h,h as c,a3 as V,g as k,t as f,a4 as j,F as q,a0 as A,e as P,p as O}from"./main-Cyrkw258.js";const T="https://nomanssky.fandom.com/api.php",N=e=>{const a=new URLSearchParams;return Object.entries(e).forEach((([e,s])=>{a.append(e,s.toString())})),`${T}?${a.toString()}`},D={format:"json",origin:"*"},F=(e,a,s)=>{const l={...D,action:"cargoquery",tables:"Bases",fields:["Name","CensusPlayer","CensusReddit","CensusDiscord","CensusFriend","System","Platform","Mode","CensusArrival","CensusRenewal","Builderlink"].join(","),where:`CensusShow IS NOT NULL AND Civilized='${e}'${s?` AND CensusRenewal HOLDS ${s}`:""}`,order_by:"CensusRenewal DESC",group_by:"CensusPlayer",limit:500,offset:a};return console.log(l),N(l)},R=async e=>{try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.text(),l=M(s);return JSON.parse(l)}catch(e){throw console.error("API call failed:",e),e}},M=e=>e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),W=e=>e.cargoquery.map((({title:e})=>({Name:e.Name,_pageName:e._pageName||e.Name,CensusPlayer:e.CensusPlayer||"Desconocido",System:e.System||"Desconocido",Platform:e.Platform||"Desconocida",Mode:e.Mode||"Desconocido",CensusArrival:e.CensusArrival||"Desconocido",CensusRenewal:e.CensusRenewal||"Desconocido",Builderlink:e.Builderlink,CensusReddit:e.CensusReddit,CensusDiscord:e.CensusDiscord,CensusFriend:e.CensusFriend,CensusVerified:e.CensusVerified}))),z=async(e,a,s)=>{const l=F(e,a,s),n=await R(l);if(null==n||!n.cargoquery)throw new Error("Invalid API response structure");return W(n)},H=async e=>{var a,s;const l={...D,action:"parse",page:e,prop:"wikitext"},n=N(l),i=await R(n),t=((null==(s=null==(a=null==i?void 0:i.parse)?void 0:a.wikitext)?void 0:s["*"])||"").match(/\|\s*image\s*=\s*(.+)/i);return t?t[1].split("\n")[0].split("|")[0].trim():null},Q=async e=>{var a;e.toLowerCase().startsWith("file:")||(e="File:"+e);const s={...D,action:"query",titles:e,prop:"imageinfo",iiprop:"url"},l=N(s),n=await R(l),i=null==(a=null==n?void 0:n.query)?void 0:a.pages;if(i){const e=i[Object.keys(i)[0]];if(e&&e.imageinfo&&e.imageinfo[0]){const a=e.imageinfo[0].url;return{panel:a.split("/revision")[0],modal:a.split("revision")[0]}}}return null},J=async e=>{const a=await H(e);return a?await Q(a):null},K={class:"space-page-container"},Y={class:"filter-container mb-4 flex items-center"},Z={class:"panel-content"},G={class:"security-level mt-2"},X={class:"update-info"},ee={key:0,class:"loading-message"},se={key:1,class:"error-message p-error"},ae={class:"p-4 base-content"},te={class:"flex flex-column gap-3"},ne={class:"flex align-items-center gap-2"},le={class:"base-title"},oe={class:"base-details"},re={class:"detail-item"},ie={class:"detail-value"},ce={class:"detail-item"},ue={class:"detail-value"},de={class:"flex gap-2"},pe={class:"panel-content-with-image"},me=["href"],ge=["src","onClick"],ye="Royal Space Society",ve=L({__name:"CensusTable",setup(e){const a=_([]),l=_(!0),n=_(null),i=_(window.innerWidth),t=_(""),r=U((()=>i.value<768?1:i.value<1200?2:3)),o=async(e=0,s)=>{try{const l=await z(ye,e,s);await Promise.all(l.map((async e=>{e.imageUrl=await J(e._pageName)}))),a.value=[...a.value,...l],500===l.length&&await o(e+500,s)}catch(e){n.value="Error al cargar las bases",console.error(e)}finally{l.value=!1}},u=async()=>{a.value=[],l.value=!0,n.value=null,await o(0,t.value)};E((async()=>{window.addEventListener("resize",(()=>i.value=window.innerWidth)),await o(0,t.value)}));const p=e=>e.trim().replace(/\s+/g,"_").replace(/\//g,"_").replace(/:/g,":").replace(/'/g,"'");return(e,i)=>(d(),x(c(I),{class:"p-0 galactic-card"},{content:v((()=>[s("div",K,[i[11]||(i[11]=s("div",{class:"flex items-start justify-between mb-6 header-container"},[s("div",{class:"flex flex-col"},[s("a",{href:"https://nomanssky.fandom.com/es/wiki/Royal_Space_Society",target:"_blank"},[s("div",{class:"rss-logo"},[s("img",{src:$,class:"logo-image",alt:"RSS Logo"})])]),s("div",{class:"header-container"},[s("div",{class:"title-theme-container"},[s("h1",{class:"galactic-title"},[s("span",{class:"title-text"},"Censo de Bases - Royal Space Society")])])]),s("p",{class:"text-stellar-gray mt-2"},"Explora las bases espaciales de la Royal Space Society")])],-1)),s("div",Y,[i[1]||(i[1]=s("label",{for:"yearInput",class:"mr-2"},"Selecciona el año del censo:",-1)),g(c(V),{id:"yearInput",type:"number",modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=e=>t.value=e),placeholder:"Ej. 2023",class:"p-inputtext"},null,8,["modelValue"]),s("button",{onClick:u,class:"p-button p-component ml-2"},"Filtrar")]),g(c(B),{class:"galactic-panel mt-6"},{header:v((()=>i[2]||(i[2]=[s("h2",{class:"panel-title"},"Información del Censo",-1)]))),default:v((()=>[s("div",Z,[s("p",null,[i[3]||(i[3]=k("Total de bases registradas: ")),s("strong",null,f(a.value.length),1)]),s("p",G,[i[4]||(i[4]=k(" Nivel de seguridad: ")),g(c(C),{value:"Clasificado RSS",severity:"info",class:"category-tag"})]),s("p",X,"Última actualización: "+f((new Date).toLocaleDateString()),1)])])),_:1}),i[12]||(i[12]=s("br",null,null,-1)),l.value?(d(),h("div",ee,i[5]||(i[5]=[s("i",{class:"pi pi-spinner pi-spin"},null,-1),k(" Cargando bases espaciales... ")]))):n.value?(d(),h("div",se,[i[6]||(i[6]=s("i",{class:"pi pi-exclamation-triangle"},null,-1)),k(" "+f(n.value),1)])):(d(),h("div",{key:2,class:"grid gap-4",style:j(`grid-template-columns: repeat(${r.value}, 1fr)`)},[(d(!0),h(q,null,A(a.value,((e,a)=>(d(),x(c(I),{key:a,class:"link-card"},{content:v((()=>[s("div",ae,[s("div",te,[s("div",ne,[s("h3",le,f(e.Name),1),g(c(C),{value:e.Platform,severity:"info",class:"category-tag"},null,8,["value"])]),s("div",oe,[s("div",re,[i[7]||(i[7]=s("span",{class:"detail-label"},"Jugador:",-1)),s("span",ie,f(e.CensusPlayer),1)]),s("div",ce,[i[8]||(i[8]=s("span",{class:"detail-label"},"Sistema:",-1)),s("span",ue,f(e.System),1)]),s("div",de,[g(c(C),{value:e.Mode,severity:"success",class:"category-tag"},null,8,["value"]),g(c(C),{value:`Llegada: ${e.CensusArrival}`,severity:"warning",class:"category-tag"},null,8,["value"]),g(c(C),{value:`Renovación: ${e.CensusRenewal}`,severity:"danger",class:"category-tag"},null,8,["value"])])]),e.Name?(d(),x(c(B),{key:0,class:"builder-panel mt-3"},{header:v((()=>i[9]||(i[9]=[s("span",{class:"builder-link-header"},"Enlaces de la Base",-1)]))),default:v((()=>[s("div",pe,[s("a",{href:`https://nomanssky.fandom.com/wiki/${p(e._pageName)}`,target:"_blank",class:"builder-link"},i[10]||(i[10]=[s("i",{class:"pi pi-external-link"},null,-1),k(" Ver detalles de construcción ")]),8,me),e.imageUrl?(d(),h("img",{key:0,src:e.imageUrl.panel,alt:"Imagen de la base",class:"panel-base-image",onClick:a=>(e=>{window.open(e,"_blank")})(`https://nomanssky.fandom.com/wiki/${p(e._pageName)}`)},null,8,ge)):P("",!0)])])),_:2},1024)):P("",!0)])])])),_:2},1024)))),128))],4))])])),_:1}))}}),ke=O(ve,[["__scopeId","data-v-c0d83dff"]]);export{ke as default};
