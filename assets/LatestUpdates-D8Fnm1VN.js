import{F as e,M as t,N as n,P as r,at as i,d as a,dt as o,f as s,h as c,ht as l,l as u,m as d,mt as ee,p as te,q as f,t as ne,v as p,x as re,y as m}from"./runtime-dom.esm-bundler-DokFv1WN.js";import{t as h}from"./button-eiEoyAAE.js";import{t as ie}from"./ThemeSwitch-DYj5Gv8l.js";import"./baseinput-BFbMRtx5.js";import{t as ae}from"./dialog-CRErTMdk.js";import{t as g}from"./_plugin-vue_export-helper-D6098ZHW.js";import{t as _}from"./card-3k4y6b13.js";import{t as oe}from"./panel-BzcgKV24.js";import{t as v}from"./logo-white-CAp0XnaH.js";import{t as se}from"./tag-BgcZK6xm.js";import{t as ce}from"./inputnumber-DMWzPG4I.js";import{a as le}from"./api-DnarUB0H.js";var ue={class:`space-page-container`},y={class:`flex items-start justify-between mb-6 header-container`},b={class:`flex flex-col`},x={class:`text-stellar-gray mt-2`},S={class:`mb-4 flex items-center gap-2`},C={class:`panel-content`},w={class:`update-info`},T={key:0,class:`loading-message`},E={key:1,class:`error-message p-error`},D={class:`p-4`},O={class:`flex flex-column gap-3`},k={class:`flex align-items-center gap-2`},A={class:`update-title`},j={class:`flex justify-between items-center mb-3`},M={class:`update-date`},N={class:`update-date-formatted`},P={key:0,class:`image-container`},F=[`src`,`alt`],I={class:`update-details`},L={class:`detail-item`},R={class:`detail-value`},z={key:0,class:`summary-box`},B={key:1,class:`fixes-box`},V={class:`fixes-preview`},H={class:`fix-text`},de={key:0,class:`fixes-actions`},fe={class:`dialog-content`},pe={class:`fixes-count`},me={class:`fixes-list-container`},he={class:`fix-number`},ge={class:`fix-content`},_e={class:`dialog-footer`},ve={class:`mt-3 flex justify-between`},ye=[`href`],be=[`href`],U=g(re({__name:`LatestUpdates`,setup(re){let g=a(()=>q.value.slice(0,K.value)),v=i({}),U=i(!0),W=i(null),G=i(window.innerWidth),K=i(10),q=i([]),J=i(!1),Y=i({}),xe=a(()=>G.value<768?1:G.value<1200?2:3),X=async()=>{try{let e=new URLSearchParams({action:`parse`,page:`Noticias`,prop:`text`,format:`json`,origin:`*`}),t=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${e.toString()}`)).json()).parse.text[`*`];Se(t)}catch(e){W.value=`Error al cargar las noticias`,console.error(e)}},Se=e=>{let t=new DOMParser,n=t.parseFromString(e,`text/html`).querySelector(`.plainlinks`);if(!n)return;let r=[],i=n.innerHTML.split(`<br>`);for(let e of i){if(!e.trim())continue;let n=t.parseFromString(e,`text/html`),i=n.querySelector(`a`);if(i){let e=i.textContent?.trim()||``,t=i.getAttribute(`href`)||``,a=decodeURIComponent(t.split(`/wiki/`).pop()||``).replace(/_/g,` `).match(/(\d+\.\d+(\.\d+)?)/),o=n.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);a&&o&&r.push({title:e,link:`https://nomanssky.fandom.com${t}`,date:o[1],version:a[1]})}}q.value=r,Ce()},Ce=async()=>{try{for(let e of g.value){let t=await we(e.link);t&&(v.value[e.version]=t)}}catch(e){console.error(`Error fetching update details:`,e)}finally{U.value=!1}},we=async e=>{try{let t=e.split(`/wiki/`)[1],n=new URLSearchParams({action:`parse`,page:decodeURIComponent(t),prop:`wikitext`,format:`json`,origin:`*`}),r=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${n.toString()}`)).json()).parse.wikitext[`*`];return Z(r,t)}catch(t){return console.error(`Error fetching details for ${e}:`,t),{}}},Te=e=>(e=e.replace(/'''/g,``),e=e.replace(/''/g,``),e=e.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,`$2`),e=e.replace(/\[\[([^\]]+)\]\]/g,`$1`),e=e.replace(/<br\s*\/?>/gi,`
`),e),Z=async(e,t)=>{let n={fixes:[]},r=e.match(/\|\s*image\s*=\s*(.+?)\n/);if(r){let e=await le(r[1].split(`
`)[0].split(`|`)[0].trim());e&&(n.image=e)}let i=e.match(/\|\s*date\s*=\s*(.+?)\n/);i&&(n.date=i[1].trim());let a=e.match(/\|\s*platform\s*=\s*(.+?)\n/);a&&(n.platforms=a[1].trim());let o=e.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);o&&(n.link=o[1].trim());let s=e.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);s&&(n.summary=Te(s[1].trim()));let c=e.match(/==\s*(?:corre(?:cci[oó]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(c){let e=c[1].matchAll(/^\*\s*(.+)$/gm);for(let t of e){let e=t[1].replace(/\s+/g,` `).trim();n.fixes?.push(e)}}return n};t(()=>{window.addEventListener(`resize`,()=>G.value=window.innerWidth),X()});let Ee=()=>{U.value=!0,W.value=null,q.value=[],v.value={},X()},Q=e=>{let t={enero:`01`,febrero:`02`,marzo:`03`,abril:`04`,mayo:`05`,junio:`06`,julio:`07`,agosto:`08`,septiembre:`09`,octubre:`10`,noviembre:`11`,diciembre:`12`},n=e.split(` de `);return n.length===3?`${n[0].padStart(2,`0`)}/${t[n[1].toLowerCase()]}/${n[2]}`:e},De=a(()=>g.value.length>0?Q(g.value[0].date):`N/A`),$=()=>{J.value=window.scrollY>300},Oe=()=>{window.scrollTo({top:0,behavior:`smooth`})};t(()=>{window.addEventListener(`scroll`,$)}),n(()=>{window.removeEventListener(`scroll`,$)});let ke=e=>{Y.value[e]=!0},Ae=e=>{Y.value[e]=!1};return(t,n)=>(r(),c(u,null,[m(o(_),{class:`p-0 galactic-card`},{content:f(()=>[s(`div`,ue,[s(`div`,y,[s(`div`,b,[n[1]||=s(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[s(`div`,{class:`wiki-logo`},[s(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`Wiki Logo`})])],-1),n[2]||=s(`div`,{class:`header-container`},[s(`div`,{class:`title-theme-container`},[s(`h1`,{class:`galactic-title`},[s(`span`,{class:`title-text`},`Actualizaciones de No Man's Sky`)])])],-1),n[3]||=s(`p`,{class:`text-stellar-gray mt-2`},`Últimas actualizaciones del juego desde la wiki oficial`,-1),s(`p`,x,[m(ie,{style:{"margin-right":`2rem`}})])])]),s(`div`,S,[n[4]||=s(`label`,{for:`maxUpdates`,class:`text-stellar-gray font-semibold`},`Mostrar hasta:`,-1),m(o(ce),{id:`maxUpdates`,modelValue:K.value,"onUpdate:modelValue":n[0]||=e=>K.value=e,min:1,max:15,showButtons:!0,inputClass:`p-inputtext-sm`,class:`mx-2`},null,8,[`modelValue`]),n[5]||=s(`span`,{class:`text-stellar-gray`},`actualizaciones`,-1),n[6]||=s(`br`,null,null,-1),n[7]||=s(`br`,null,null,-1),m(o(h),{label:`Buscar Actualizaciones`,icon:`pi pi-refresh`,class:`p-button-outlined p-button-sm`,onClick:Ee})]),m(o(oe),{class:`galactic-panel`},{header:f(()=>[...n[8]||=[s(`h2`,{class:`panel-title`},`Historial de Actualizaciones`,-1)]]),default:f(()=>[s(`div`,C,[s(`p`,null,[n[9]||=p(` Total de actualizaciones recientes: `,-1),s(`strong`,null,l(g.value.length),1)]),s(`p`,w,`Última actualización: `+l(De.value),1)])]),_:1}),n[19]||=s(`br`,null,null,-1),U.value?(r(),c(`div`,T,[...n[10]||=[s(`i`,{class:`pi pi-spinner pi-spin`},null,-1),p(` Cargando actualizaciones... `,-1)]])):W.value?(r(),c(`div`,E,[n[11]||=s(`i`,{class:`pi pi-exclamation-triangle`},null,-1),p(` `+l(W.value),1)])):(r(),c(`div`,{key:2,class:`grid gap-4`,style:ee(`grid-template-columns: repeat(${xe.value}, 1fr)`)},[(r(!0),c(u,null,e(g.value,(t,i)=>(r(),te(o(_),{key:i,class:`update-card`},{content:f(()=>[s(`div`,D,[s(`div`,O,[s(`div`,k,[s(`h3`,A,l(t.title),1),m(o(se),{value:t.version,severity:`info`,class:`version-tag`},null,8,[`value`])]),s(`div`,j,[s(`span`,M,l(t.date),1),s(`span`,N,l(Q(t.date)),1)]),v.value[t.version]?.image?(r(),c(`div`,P,[s(`img`,{src:v.value[t.version]?.image?.panel,alt:t.title,class:`update-image`},null,8,F)])):d(``,!0),s(`div`,I,[s(`div`,L,[n[12]||=s(`span`,{class:`detail-label`},`Plataformas:`,-1),s(`span`,R,l(v.value[t.version]?.platforms||`Todas`),1)]),v.value[t.version]?.summary?(r(),c(`div`,z,[n[13]||=s(`span`,{class:`detail-label`},`Resumen:`,-1),s(`p`,null,l(v.value[t.version]?.summary),1)])):d(``,!0),v.value[t.version]?.fixes&&v.value[t.version]?.fixes.length>0?(r(),c(`div`,B,[n[16]||=s(`div`,{class:`fixes-header`},[s(`i`,{class:`pi pi-wrench fixes-icon`}),s(`span`,{class:`detail-label`},`Correcciones principales:`)],-1),s(`div`,V,[(r(!0),c(u,null,e(v.value[t.version]?.fixes?.slice(0,3),(e,t)=>(r(),c(`div`,{key:t,class:`fix-item`},[n[14]||=s(`div`,{class:`fix-bullet`},null,-1),s(`span`,H,l(e),1)]))),128))]),v.value[t.version]?.fixes.length>3?(r(),c(`div`,de,[m(o(h),{label:`Ver todas (${v.value[t.version]?.fixes.length})`,icon:`pi pi-list`,class:`p-button-text p-button-sm view-all-btn`,onClick:e=>ke(t.version)},null,8,[`label`,`onClick`])])):d(``,!0),m(o(ae),{visible:Y.value[t.version],"onUpdate:visible":e=>Y.value[t.version]=e,header:`Correcciones completas - Versión ${t.version}`,modal:``,closable:!1,dismissableMask:``,class:`fixes-dialog`,style:{width:`90vw`,maxWidth:`800px`}},{footer:f(()=>[s(`div`,_e,[m(o(h),{label:`Cerrar`,icon:`pi pi-times`,class:`p-button-outlined`,onClick:e=>Ae(t.version)},null,8,[`onClick`])])]),default:f(()=>[s(`div`,fe,[s(`div`,pe,[n[15]||=s(`i`,{class:`pi pi-info-circle`},null,-1),s(`span`,null,`Total de correcciones: `+l(v.value[t.version]?.fixes?.length),1)]),s(`div`,me,[(r(!0),c(u,null,e(v.value[t.version]?.fixes,(e,t)=>(r(),c(`div`,{key:t,class:`dialog-fix-item`},[s(`div`,he,l(t+1),1),s(`div`,ge,l(e),1)]))),128))])])]),_:2},1032,[`visible`,`onUpdate:visible`,`header`])])):d(``,!0),s(`div`,ve,[s(`a`,{href:t.link,target:`_blank`,class:`wiki-link`},[...n[17]||=[s(`i`,{class:`pi pi-book`},null,-1),p(` Ver en wiki `,-1)]],8,ye),v.value[t.version]?.link?(r(),c(`a`,{key:0,href:v.value[t.version]?.link,target:`_blank`,class:`official-link`},[...n[18]||=[s(`i`,{class:`pi pi-globe`},null,-1),p(` Nota oficial `,-1)]],8,be)):d(``,!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),m(ne,{name:`fade`},{default:f(()=>[J.value?(r(),c(`button`,{key:0,onClick:Oe,class:`scroll-top-button`},[...n[20]||=[s(`i`,{class:`pi pi-arrow-up`},null,-1)]])):d(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-5f0dda4a`]]);export{U as default};