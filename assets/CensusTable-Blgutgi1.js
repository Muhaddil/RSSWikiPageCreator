import{A as e,At as t,D as n,E as r,W as i,_ as ee,c as a,ct as o,h as s,k as c,kt as te,l,m as u,nt as d,o as f,r as p,s as m,u as h}from"./runtime-core.esm-bundler-DchWbIG6.js";import{t as ne}from"./runtime-dom.esm-bundler-BLbTed6u.js";import{t as g}from"./button-B2IlAsp7.js";import"./portal-DzRr4Kdd.js";import"./baseinput-DGGDxDlI.js";import{t as re}from"./inputtext-8SA5CJIi.js";import{t as _}from"./_plugin-vue_export-helper-DyZRSbhD.js";import"./iconfield-pzYhGlfx.js";import"./select-C1SuYcp_.js";import"./check-DajuQgww.js";import"./chevrondown-DCmttgiT.js";import{t as v}from"./card-BcBQ0oRB.js";import"./minus-B1GCgViL.js";import{t as y}from"./panel-CbD19-xJ.js";import{t as b}from"./logo-white-DFArQECj.js";import{t as x}from"./tag-yAZDWcTO.js";import{t as ie}from"./paginator-BzSykKfl.js";import"./inputnumber-D4k_NVyc.js";import{t as S}from"./dropdown-BIHJkvok.js";import{n as ae,t as oe}from"./api-Dd_1aBjs.js";var se={class:`space-page-container`},ce={class:`filter-container mb-6`},le={class:`filter-row`},ue={class:`year-filter`},de={class:`input-group`},fe={class:`pagination-filter`},pe={key:0,class:`rows-filter`},me={class:`flex justify-between items-center mt-3`},he={key:0,class:`filter-info`},ge={class:`info-text`},_e={class:`flex`},C={class:`panel-content`},w={key:0,class:`storage-indicator`},T={class:`security-level mt-2`},E={class:`update-info`},D={key:1,class:`loading-message`},O={key:2,class:`error-message p-error`},k={key:3,class:`empty-message`},A={class:`p-4 base-content`},j={class:`flex flex-column gap-3`},M={class:`flex align-items-center gap-2`},N={class:`base-title`},P={class:`base-details`},F={class:`detail-item`},I={class:`detail-value`},ve={class:`detail-item`},ye={class:`detail-value`},be={class:`flex gap-2`},xe={class:`panel-content-with-image`},Se=[`href`],Ce=[`src`,`onClick`],L=3e4,we=`Royal Space Society`,R=_(ee({__name:`CensusTable`,setup(ee){let _={BASES:`rss_census_bases`,LAST_FETCH:`rss_last_fetch_timestamp`,YEAR_FILTER:`rss_year_filter`},b=d([]),R=d(!0),z=d(null),B=d(window.innerWidth),V=d(``),H=d(!0),U=d(0),W=d(12),G=d(!1),K=d(!0),q=d(0),Te=[{label:`6 por página`,value:6},{label:`12 por página`,value:12},{label:`27 por página`,value:27},{label:`48 por página`,value:48}],Ee=f(()=>H.value?b.value.slice(U.value,U.value+W.value):b.value),De=[{label:`Sí, usar paginación`,value:!0},{label:`No, mostrar todo`,value:!1}],Oe=f(()=>B.value<768?1:B.value<1200?2:3),J=()=>{try{let e=localStorage.getItem(_.BASES),t=localStorage.getItem(_.LAST_FETCH);if(e&&(b.value=JSON.parse(e)),V.value=``,t){let e=Date.now()-parseInt(t);e<L&&(K.value=!1,Y(L-e))}}catch(e){console.error(`Error loading from localStorage:`,e)}},ke=()=>{try{localStorage.setItem(_.BASES,JSON.stringify(b.value)),localStorage.setItem(_.LAST_FETCH,Date.now().toString())}catch(e){console.error(`Error saving to localStorage:`,e)}},Y=e=>{K.value=!1,q.value=Math.ceil(e/1e3);let t=setInterval(()=>{q.value--,q.value<=0&&(clearInterval(t),K.value=!0,q.value=0)},1e3)},X=async(e=0,t)=>{try{let n=await ae(we,e,t),r=n;await Promise.all(r.map(async e=>{try{e.imageUrl=await oe(e._pageName)}catch{console.warn(`No se pudo cargar imagen para ${e._pageName}`),e.imageUrl=null}})),e===0?b.value=n:b.value=[...b.value,...n],ke(),n.length===500&&await X(e+500,t)}catch(e){z.value=`Error al cargar las bases`,console.error(e)}finally{R.value=!1}},Z=async()=>{if(!K.value){z.value=`Espera ${q.value} segundos antes de actualizar`;return}b.value=[],R.value=!0,z.value=null,Y(L),await X(0,V.value)};r(async()=>{window.addEventListener(`resize`,()=>B.value=window.innerWidth),window.addEventListener(`scroll`,$),R.value=!0,J(),(b.value.length===0||K.value)&&(console.log(`Fetched bases from wiki`),await X(0)),R.value=!1});let Q=e=>e.trim().replace(/\s+/g,`_`).replace(/\//g,`_`),Ae=e=>{window.open(e,`_blank`)},je=()=>{U.value=0},$=()=>{G.value=window.scrollY>300},Me=()=>{window.scrollTo({top:0,behavior:`smooth`})};return r(()=>{window.addEventListener(`scroll`,$)}),n(()=>{window.removeEventListener(`scroll`,$)}),(n,r)=>(c(),h(p,null,[s(o(v),{class:`p-0 galactic-card`},{content:i(()=>[m(`div`,se,[r[23]||=m(`div`,{class:`flex items-start justify-between mb-6 header-container`},[m(`div`,{class:`flex flex-col`},[m(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[m(`div`,{class:`rss-logo`},[m(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`RSS Logo`})])]),m(`div`,{class:`header-container`},[m(`div`,{class:`title-theme-container`},[m(`h1`,{class:`galactic-title`},[m(`span`,{class:`title-text`},`Censo de Bases - Royal Space Society`)])])]),m(`p`,{class:`text-stellar-gray mt-2`},`Explora las bases espaciales de la Royal Space Society`)])],-1),m(`div`,ce,[m(`div`,le,[m(`div`,ue,[r[4]||=m(`label`,{for:`yearInput`,class:`filter-label`},[m(`i`,{class:`pi pi-calendar mr-2`}),u(` Año del censo: `)],-1),m(`div`,de,[s(o(re),{id:`yearInput`,type:`number`,modelValue:V.value,"onUpdate:modelValue":r[0]||=e=>V.value=e,placeholder:`Ej. 2023`,class:`year-input`},null,8,[`modelValue`]),s(o(g),{onClick:Z,icon:`pi pi-search`,label:`Filtrar`,class:`filter-btn`,loading:R.value,disabled:!K.value},null,8,[`loading`,`disabled`])])]),m(`div`,fe,[r[5]||=m(`label`,{class:`filter-label`},[m(`i`,{class:`pi pi-list mr-2`}),u(` Paginación: `)],-1),s(o(S),{modelValue:H.value,"onUpdate:modelValue":r[1]||=e=>H.value=e,options:De,optionLabel:`label`,optionValue:`value`,class:`pagination-dropdown`},null,8,[`modelValue`])]),H.value?(c(),h(`div`,pe,[r[6]||=m(`label`,{class:`filter-label`},[m(`i`,{class:`pi pi-th-large mr-2`}),u(` Elementos: `)],-1),s(o(S),{modelValue:W.value,"onUpdate:modelValue":r[2]||=e=>W.value=e,options:Te,optionLabel:`label`,optionValue:`value`,class:`rows-dropdown`,onChange:je},null,8,[`modelValue`])])):l(``,!0)]),m(`div`,me,[b.value.length>0?(c(),h(`div`,he,[m(`span`,ge,[r[7]||=m(`i`,{class:`pi pi-database mr-1`},null,-1),u(` Total: `+t(b.value.length)+` bases `,1),r[8]||=m(`i`,{class:`pi pi-cloud ml-2 mr-1`},null,-1),r[9]||=m(`span`,null,`(Guardadas localmente)`,-1)])])):l(``,!0),m(`div`,_e,[s(o(g),{onClick:Z,icon:`pi pi-refresh`,label:`Actualizar`,class:`update-btn mr-2 mt-2 last:mr-0 last:mt-0`,loading:R.value,disabled:!K.value,severity:`help`},null,8,[`loading`,`disabled`]),K.value?l(``,!0):(c(),a(o(g),{key:0,label:`Esperar ${q.value}s`,class:`cooldown-btn last:mr-0 last:mt-0`,severity:`secondary`,disabled:``},null,8,[`label`]))])])]),H.value&&b.value.length>W.value?(c(),a(o(ie),{key:0,first:U.value,rows:W.value,totalRecords:b.value.length,onPage:r[3]||=e=>{U.value=e.first,W.value=e.rows},class:`mb-4`},null,8,[`first`,`rows`,`totalRecords`])):l(``,!0),s(o(y),{class:`galactic-panel mt-6`},{header:i(()=>[...r[10]||=[m(`h2`,{class:`panel-title`},`Información del Censo`,-1)]]),default:i(()=>[m(`div`,C,[m(`p`,null,[r[12]||=u(` Total de bases registradas: `,-1),m(`strong`,null,t(b.value.length),1),b.value.length>0?(c(),h(`span`,w,[...r[11]||=[m(`i`,{class:`pi pi-cloud ml-2`},null,-1),u(` Datos en cache `,-1)]])):l(``,!0)]),m(`p`,T,[r[13]||=u(` Nivel de seguridad: `,-1),s(o(x),{value:`Clasificado RSS`,severity:`info`,class:`category-tag`})]),m(`p`,E,[u(` Última actualización: `+t(new Date().toLocaleDateString())+` `,1),r[14]||=m(`br`,null,null,-1),r[15]||=m(`small`,null,`Límite API: 2 consultas por minuto`,-1)])])]),_:1}),r[24]||=m(`br`,null,null,-1),R.value?(c(),h(`div`,D,[...r[16]||=[m(`i`,{class:`pi pi-spinner pi-spin`},null,-1),u(` Cargando bases espaciales... `,-1)]])):z.value?(c(),h(`div`,O,[r[17]||=m(`i`,{class:`pi pi-exclamation-triangle`},null,-1),u(` `+t(z.value),1)])):b.value.length===0?(c(),h(`div`,k,[...r[18]||=[m(`i`,{class:`pi pi-info-circle`},null,-1),u(` No se encontraron bases `,-1)]])):(c(),h(`div`,{key:4,class:`grid gap-4`,style:te(`grid-template-columns: repeat(${Oe.value}, 1fr)`)},[(c(!0),h(p,null,e(Ee.value,(e,n)=>(c(),a(o(v),{key:n,class:`link-card`},{content:i(()=>[m(`div`,A,[m(`div`,j,[m(`div`,M,[m(`h3`,N,t(e.Name),1),s(o(x),{value:e.Platform,severity:`info`,class:`category-tag`},null,8,[`value`])]),m(`div`,P,[m(`div`,F,[r[19]||=m(`span`,{class:`detail-label`},`Jugador:`,-1),m(`span`,I,t(e.CensusPlayer),1)]),m(`div`,ve,[r[20]||=m(`span`,{class:`detail-label`},`Sistema:`,-1),m(`span`,ye,t(e.System),1)]),m(`div`,be,[s(o(x),{value:e.Mode,severity:`success`,class:`category-tag`},null,8,[`value`]),s(o(x),{value:`Llegada: ${e.CensusArrival}`,severity:`warning`,class:`category-tag`},null,8,[`value`]),s(o(x),{value:`Renovación: ${e.CensusRenewal}`,severity:`danger`,class:`category-tag`},null,8,[`value`])])]),e.Name?(c(),a(o(y),{key:0,class:`builder-panel mt-3`},{header:i(()=>[...r[21]||=[m(`span`,{class:`builder-link-header`},`Enlaces de la Base`,-1)]]),default:i(()=>[m(`div`,xe,[m(`a`,{href:`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`,target:`_blank`,class:`builder-link`},[...r[22]||=[m(`i`,{class:`pi pi-external-link`},null,-1),u(` Ver detalles de construcción `,-1)]],8,Se),e.imageUrl?(c(),h(`img`,{key:0,src:e.imageUrl.panel,alt:`Imagen de la base`,class:`panel-base-image`,onClick:t=>Ae(`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`)},null,8,Ce)):l(``,!0)])]),_:2},1024)):l(``,!0)])])]),_:2},1024))),128))],4))])]),_:1}),s(ne,{name:`fade`},{default:i(()=>[G.value?(c(),h(`button`,{key:0,onClick:Me,class:`scroll-top-button`},[...r[25]||=[m(`i`,{class:`pi pi-arrow-up`},null,-1)]])):l(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-8739e7af`]]);export{R as default};