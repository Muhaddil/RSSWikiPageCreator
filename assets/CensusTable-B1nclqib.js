import{F as e,I as t,N as n,P as r,S as ee,at as i,b as a,dt as o,f as s,g as c,h as l,ht as u,m as d,mt as te,p as f,q as p,t as ne,u as m,y as h}from"./runtime-dom.esm-bundler-B0omDyfX.js";import{t as g}from"./button-RKJIGzvd.js";import"./baseinput-CZKnC-4G.js";import{t as re}from"./inputtext-DPdEsQIm.js";import{t as _}from"./_plugin-vue_export-helper-B-x99n_9.js";import{t as v}from"./card-C6b-8PfK.js";import{t as y}from"./panel-BN68OP1F.js";import{t as b}from"./logo-white-CmB7GzSq.js";import{t as x}from"./tag-pUSeKvM8.js";import{t as ie}from"./paginator-Ue29aeBI.js";import{t as S}from"./dropdown-DB0fgI2B.js";import{n as ae,t as oe}from"./api-lfChQBpo.js";var se={class:`space-page-container`},ce={class:`filter-container mb-6`},le={class:`filter-row`},ue={class:`year-filter`},de={class:`input-group`},fe={class:`pagination-filter`},pe={key:0,class:`rows-filter`},me={class:`flex justify-between items-center mt-3`},he={key:0,class:`filter-info`},ge={class:`info-text`},_e={class:`flex`},C={class:`panel-content`},w={key:0,class:`storage-indicator`},T={class:`security-level mt-2`},E={class:`update-info`},D={key:1,class:`loading-message`},O={key:2,class:`error-message p-error`},k={key:3,class:`empty-message`},A={class:`p-4 base-content`},j={class:`flex flex-column gap-3`},M={class:`flex align-items-center gap-2`},N={class:`base-title`},P={class:`base-details`},F={class:`detail-item`},I={class:`detail-value`},ve={class:`detail-item`},ye={class:`detail-value`},be={class:`flex gap-2`},xe={class:`panel-content-with-image`},Se=[`href`],Ce=[`src`,`onClick`],L=3e4,we=`Royal Space Society`,R=_(ee({__name:`CensusTable`,setup(ee){let _={BASES:`rss_census_bases`,LAST_FETCH:`rss_last_fetch_timestamp`,YEAR_FILTER:`rss_year_filter`},b=i([]),R=i(!0),z=i(null),B=i(window.innerWidth),V=i(``),H=i(!0),U=i(0),W=i(12),G=i(!1),K=i(!0),q=i(0),Te=[{label:`6 por página`,value:6},{label:`12 por página`,value:12},{label:`27 por página`,value:27},{label:`48 por página`,value:48}],Ee=s(()=>H.value?b.value.slice(U.value,U.value+W.value):b.value),De=[{label:`Sí, usar paginación`,value:!0},{label:`No, mostrar todo`,value:!1}],Oe=s(()=>B.value<768?1:B.value<1200?2:3),J=()=>{try{let e=localStorage.getItem(_.BASES),t=localStorage.getItem(_.LAST_FETCH);if(e&&(b.value=JSON.parse(e)),V.value=``,t){let e=Date.now()-parseInt(t);e<L&&(K.value=!1,Y(L-e))}}catch(e){console.error(`Error loading from localStorage:`,e)}},ke=()=>{try{V.value||(localStorage.setItem(_.BASES,JSON.stringify(b.value)),localStorage.setItem(_.LAST_FETCH,Date.now().toString()))}catch(e){console.error(`Error saving to localStorage:`,e)}},Y=e=>{K.value=!1,q.value=Math.ceil(e/1e3);let t=setInterval(()=>{q.value--,q.value<=0&&(clearInterval(t),K.value=!0,q.value=0)},1e3)},X=async(e=0,t)=>{try{let n=await ae(we,e,t),r=n;await Promise.all(r.map(async e=>{try{e.imageUrl=await oe(e._pageName)}catch{console.warn(`No se pudo cargar imagen para ${e._pageName}`),e.imageUrl=null}})),e===0?b.value=n:b.value=[...b.value,...n],ke(),n.length===500&&await X(e+500,t)}catch(e){z.value=`Error al cargar las bases`,console.error(e)}finally{R.value=!1}},Z=async()=>{if(!K.value){z.value=`Espera ${q.value} segundos antes de actualizar`;return}b.value=[],R.value=!0,z.value=null,Y(L),await X(0,V.value)};n(async()=>{window.addEventListener(`resize`,()=>B.value=window.innerWidth),window.addEventListener(`scroll`,$),R.value=!0,J(),(b.value.length===0||K.value)&&await X(0),R.value=!1});let Q=e=>e.trim().replace(/\s+/g,`_`).replace(/\//g,`_`),Ae=e=>{window.open(e,`_blank`)},je=()=>{U.value=0},$=()=>{G.value=window.scrollY>300},Me=()=>{window.scrollTo({top:0,behavior:`smooth`})};return n(()=>{window.addEventListener(`scroll`,$)}),r(()=>{window.removeEventListener(`scroll`,$)}),(n,r)=>(e(),c(m,null,[a(o(v),{class:`p-0 galactic-card`},{content:p(()=>[f(`div`,se,[r[23]||=f(`div`,{class:`flex items-start justify-between mb-6 header-container`},[f(`div`,{class:`flex flex-col`},[f(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[f(`div`,{class:`rss-logo`},[f(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`RSS Logo`})])]),f(`div`,{class:`header-container`},[f(`div`,{class:`title-theme-container`},[f(`h1`,{class:`galactic-title`},[f(`span`,{class:`title-text`},`Censo de Bases - Royal Space Society`)])])]),f(`p`,{class:`text-stellar-gray mt-2`},`Explora las bases espaciales de la Royal Space Society`)])],-1),f(`div`,ce,[f(`div`,le,[f(`div`,ue,[r[4]||=f(`label`,{for:`yearInput`,class:`filter-label`},[f(`i`,{class:`pi pi-calendar mr-2`}),h(` Año del censo: `)],-1),f(`div`,de,[a(o(re),{id:`yearInput`,type:`number`,modelValue:V.value,"onUpdate:modelValue":r[0]||=e=>V.value=e,placeholder:`Ej. 2023`,class:`year-input`},null,8,[`modelValue`]),a(o(g),{onClick:Z,icon:`pi pi-search`,label:`Filtrar`,class:`filter-btn`,loading:R.value,disabled:!K.value},null,8,[`loading`,`disabled`])])]),f(`div`,fe,[r[5]||=f(`label`,{class:`filter-label`},[f(`i`,{class:`pi pi-list mr-2`}),h(` Paginación: `)],-1),a(o(S),{modelValue:H.value,"onUpdate:modelValue":r[1]||=e=>H.value=e,options:De,optionLabel:`label`,optionValue:`value`,class:`pagination-dropdown`},null,8,[`modelValue`])]),H.value?(e(),c(`div`,pe,[r[6]||=f(`label`,{class:`filter-label`},[f(`i`,{class:`pi pi-th-large mr-2`}),h(` Elementos: `)],-1),a(o(S),{modelValue:W.value,"onUpdate:modelValue":r[2]||=e=>W.value=e,options:Te,optionLabel:`label`,optionValue:`value`,class:`rows-dropdown`,onChange:je},null,8,[`modelValue`])])):l(``,!0)]),f(`div`,me,[b.value.length>0?(e(),c(`div`,he,[f(`span`,ge,[r[7]||=f(`i`,{class:`pi pi-database mr-1`},null,-1),h(` Total: `+u(b.value.length)+` bases `,1),r[8]||=f(`i`,{class:`pi pi-cloud ml-2 mr-1`},null,-1),r[9]||=f(`span`,null,`(Guardadas localmente)`,-1)])])):l(``,!0),f(`div`,_e,[a(o(g),{onClick:Z,icon:`pi pi-refresh`,label:`Actualizar`,class:`update-btn mr-2 mt-2 last:mr-0 last:mt-0`,loading:R.value,disabled:!K.value,severity:`help`},null,8,[`loading`,`disabled`]),K.value?l(``,!0):(e(),d(o(g),{key:0,label:`Esperar ${q.value}s`,class:`cooldown-btn last:mr-0 last:mt-0`,severity:`secondary`,disabled:``},null,8,[`label`]))])])]),H.value&&b.value.length>W.value?(e(),d(o(ie),{key:0,first:U.value,rows:W.value,totalRecords:b.value.length,onPage:r[3]||=e=>{U.value=e.first,W.value=e.rows},class:`mb-4`},null,8,[`first`,`rows`,`totalRecords`])):l(``,!0),a(o(y),{class:`galactic-panel mt-6`},{header:p(()=>[...r[10]||=[f(`h2`,{class:`panel-title`},`Información del Censo`,-1)]]),default:p(()=>[f(`div`,C,[f(`p`,null,[r[12]||=h(` Total de bases registradas: `,-1),f(`strong`,null,u(b.value.length),1),b.value.length>0?(e(),c(`span`,w,[...r[11]||=[f(`i`,{class:`pi pi-cloud ml-2`},null,-1),h(` Datos en cache `,-1)]])):l(``,!0)]),f(`p`,T,[r[13]||=h(` Nivel de seguridad: `,-1),a(o(x),{value:`Clasificado RSS`,severity:`info`,class:`category-tag`})]),f(`p`,E,[h(` Última actualización: `+u(new Date().toLocaleDateString())+` `,1),r[14]||=f(`br`,null,null,-1),r[15]||=f(`small`,null,`Límite API: 2 consultas por minuto`,-1)])])]),_:1}),r[24]||=f(`br`,null,null,-1),R.value?(e(),c(`div`,D,[...r[16]||=[f(`i`,{class:`pi pi-spinner pi-spin`},null,-1),h(` Cargando bases espaciales... `,-1)]])):z.value?(e(),c(`div`,O,[r[17]||=f(`i`,{class:`pi pi-exclamation-triangle`},null,-1),h(` `+u(z.value),1)])):b.value.length===0?(e(),c(`div`,k,[...r[18]||=[f(`i`,{class:`pi pi-info-circle`},null,-1),h(` No se encontraron bases `,-1)]])):(e(),c(`div`,{key:4,class:`grid gap-4`,style:te(`grid-template-columns: repeat(${Oe.value}, 1fr)`)},[(e(!0),c(m,null,t(Ee.value,(t,n)=>(e(),d(o(v),{key:n,class:`link-card`},{content:p(()=>[f(`div`,A,[f(`div`,j,[f(`div`,M,[f(`h3`,N,u(t.Name),1),a(o(x),{value:t.Platform,severity:`info`,class:`category-tag`},null,8,[`value`])]),f(`div`,P,[f(`div`,F,[r[19]||=f(`span`,{class:`detail-label`},`Jugador:`,-1),f(`span`,I,u(t.CensusPlayer),1)]),f(`div`,ve,[r[20]||=f(`span`,{class:`detail-label`},`Sistema:`,-1),f(`span`,ye,u(t.System),1)]),f(`div`,be,[a(o(x),{value:t.Mode,severity:`success`,class:`category-tag`},null,8,[`value`]),a(o(x),{value:`Llegada: ${t.CensusArrival}`,severity:`warning`,class:`category-tag`},null,8,[`value`]),a(o(x),{value:`Renovación: ${t.CensusRenewal}`,severity:`danger`,class:`category-tag`},null,8,[`value`])])]),t.Name?(e(),d(o(y),{key:0,class:`builder-panel mt-3`},{header:p(()=>[...r[21]||=[f(`span`,{class:`builder-link-header`},`Enlaces de la Base`,-1)]]),default:p(()=>[f(`div`,xe,[f(`a`,{href:`https://nomanssky.fandom.com/wiki/${Q(t._pageName)}`,target:`_blank`,class:`builder-link`},[...r[22]||=[f(`i`,{class:`pi pi-external-link`},null,-1),h(` Ver detalles de construcción `,-1)]],8,Se),t.imageUrl?(e(),c(`img`,{key:0,src:t.imageUrl.panel,alt:`Imagen de la base`,class:`panel-base-image`,onClick:e=>Ae(`https://nomanssky.fandom.com/wiki/${Q(t._pageName)}`)},null,8,Ce)):l(``,!0)])]),_:2},1024)):l(``,!0)])])]),_:2},1024))),128))],4))])]),_:1}),a(ne,{name:`fade`},{default:p(()=>[G.value?(e(),c(`button`,{key:0,onClick:Me,class:`scroll-top-button`},[...r[25]||=[f(`i`,{class:`pi pi-arrow-up`},null,-1)]])):l(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-9de8699d`]]);export{R as default};