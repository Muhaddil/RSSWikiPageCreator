import{F as e,M as t,N as n,P as r,at as i,d as a,dt as o,f as s,h as c,ht as l,l as u,m as d,mt as ee,p as f,q as p,t as te,v as m,x as ne,y as h}from"./runtime-dom.esm-bundler-DokFv1WN.js";import{t as g}from"./button-eiEoyAAE.js";import"./baseinput-BFbMRtx5.js";import{t as re}from"./inputtext-CkC4Oi0P.js";import{t as _}from"./_plugin-vue_export-helper-D6098ZHW.js";import{t as v}from"./card-3k4y6b13.js";import{t as y}from"./panel-BzcgKV24.js";import{t as b}from"./logo-white-CAp0XnaH.js";import{t as x}from"./tag-BgcZK6xm.js";import{t as ie}from"./paginator-BXcEA9iN.js";import{t as S}from"./dropdown-BEWAqcFW.js";import{n as ae,t as oe}from"./api-DnarUB0H.js";var se={class:`space-page-container`},ce={class:`filter-container mb-6`},le={class:`filter-row`},ue={class:`year-filter`},de={class:`input-group`},fe={class:`pagination-filter`},pe={key:0,class:`rows-filter`},me={class:`flex justify-between items-center mt-3`},he={key:0,class:`filter-info`},ge={class:`info-text`},_e={class:`flex`},C={class:`panel-content`},w={key:0,class:`storage-indicator`},T={class:`security-level mt-2`},E={class:`update-info`},D={key:1,class:`loading-message`},O={key:2,class:`error-message p-error`},k={key:3,class:`empty-message`},A={class:`p-4 base-content`},j={class:`flex flex-column gap-3`},M={class:`flex align-items-center gap-2`},N={class:`base-title`},P={class:`base-details`},F={class:`detail-item`},I={class:`detail-value`},ve={class:`detail-item`},ye={class:`detail-value`},be={class:`flex gap-2`},xe={class:`panel-content-with-image`},Se=[`href`],Ce=[`src`,`onClick`],L=3e4,we=`Royal Space Society`,R=_(ne({__name:`CensusTable`,setup(ne){let _={BASES:`rss_census_bases`,LAST_FETCH:`rss_last_fetch_timestamp`,YEAR_FILTER:`rss_year_filter`},b=i([]),R=i(!0),z=i(null),B=i(window.innerWidth),V=i(``),H=i(!0),U=i(0),W=i(12),G=i(!1),K=i(!0),q=i(0),Te=[{label:`6 por página`,value:6},{label:`12 por página`,value:12},{label:`27 por página`,value:27},{label:`48 por página`,value:48}],Ee=a(()=>H.value?b.value.slice(U.value,U.value+W.value):b.value),De=[{label:`Sí, usar paginación`,value:!0},{label:`No, mostrar todo`,value:!1}],Oe=a(()=>B.value<768?1:B.value<1200?2:3),J=()=>{try{let e=localStorage.getItem(_.BASES),t=localStorage.getItem(_.LAST_FETCH);if(e&&(b.value=JSON.parse(e)),V.value=``,t){let e=Date.now()-parseInt(t);e<L&&(K.value=!1,Y(L-e))}}catch(e){console.error(`Error loading from localStorage:`,e)}},ke=()=>{try{V.value||(localStorage.setItem(_.BASES,JSON.stringify(b.value)),localStorage.setItem(_.LAST_FETCH,Date.now().toString()))}catch(e){console.error(`Error saving to localStorage:`,e)}},Y=e=>{K.value=!1,q.value=Math.ceil(e/1e3);let t=setInterval(()=>{q.value--,q.value<=0&&(clearInterval(t),K.value=!0,q.value=0)},1e3)},X=async(e=0,t)=>{try{let n=await ae(we,e,t),r=n;await Promise.all(r.map(async e=>{try{e.imageUrl=await oe(e._pageName)}catch{console.warn(`No se pudo cargar imagen para ${e._pageName}`),e.imageUrl=null}})),e===0?b.value=n:b.value=[...b.value,...n],ke(),n.length===500&&await X(e+500,t)}catch(e){z.value=`Error al cargar las bases`,console.error(e)}finally{R.value=!1}},Z=async()=>{if(!K.value){z.value=`Espera ${q.value} segundos antes de actualizar`;return}b.value=[],R.value=!0,z.value=null,Y(L),await X(0,V.value)};t(async()=>{window.addEventListener(`resize`,()=>B.value=window.innerWidth),window.addEventListener(`scroll`,$),R.value=!0,J(),(b.value.length===0||K.value)&&await X(0),R.value=!1});let Q=e=>e.trim().replace(/\s+/g,`_`).replace(/\//g,`_`),Ae=e=>{window.open(e,`_blank`)},je=()=>{U.value=0},$=()=>{G.value=window.scrollY>300},Me=()=>{window.scrollTo({top:0,behavior:`smooth`})};return t(()=>{window.addEventListener(`scroll`,$)}),n(()=>{window.removeEventListener(`scroll`,$)}),(t,n)=>(r(),c(u,null,[h(o(v),{class:`p-0 galactic-card`},{content:p(()=>[s(`div`,se,[n[23]||=s(`div`,{class:`flex items-start justify-between mb-6 header-container`},[s(`div`,{class:`flex flex-col`},[s(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[s(`div`,{class:`rss-logo`},[s(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`RSS Logo`})])]),s(`div`,{class:`header-container`},[s(`div`,{class:`title-theme-container`},[s(`h1`,{class:`galactic-title`},[s(`span`,{class:`title-text`},`Censo de Bases - Royal Space Society`)])])]),s(`p`,{class:`text-stellar-gray mt-2`},`Explora las bases espaciales de la Royal Space Society`)])],-1),s(`div`,ce,[s(`div`,le,[s(`div`,ue,[n[4]||=s(`label`,{for:`yearInput`,class:`filter-label`},[s(`i`,{class:`pi pi-calendar mr-2`}),m(` Año del censo: `)],-1),s(`div`,de,[h(o(re),{id:`yearInput`,type:`number`,modelValue:V.value,"onUpdate:modelValue":n[0]||=e=>V.value=e,placeholder:`Ej. 2023`,class:`year-input`},null,8,[`modelValue`]),h(o(g),{onClick:Z,icon:`pi pi-search`,label:`Filtrar`,class:`filter-btn`,loading:R.value,disabled:!K.value},null,8,[`loading`,`disabled`])])]),s(`div`,fe,[n[5]||=s(`label`,{class:`filter-label`},[s(`i`,{class:`pi pi-list mr-2`}),m(` Paginación: `)],-1),h(o(S),{modelValue:H.value,"onUpdate:modelValue":n[1]||=e=>H.value=e,options:De,optionLabel:`label`,optionValue:`value`,class:`pagination-dropdown`},null,8,[`modelValue`])]),H.value?(r(),c(`div`,pe,[n[6]||=s(`label`,{class:`filter-label`},[s(`i`,{class:`pi pi-th-large mr-2`}),m(` Elementos: `)],-1),h(o(S),{modelValue:W.value,"onUpdate:modelValue":n[2]||=e=>W.value=e,options:Te,optionLabel:`label`,optionValue:`value`,class:`rows-dropdown`,onChange:je},null,8,[`modelValue`])])):d(``,!0)]),s(`div`,me,[b.value.length>0?(r(),c(`div`,he,[s(`span`,ge,[n[7]||=s(`i`,{class:`pi pi-database mr-1`},null,-1),m(` Total: `+l(b.value.length)+` bases `,1),n[8]||=s(`i`,{class:`pi pi-cloud ml-2 mr-1`},null,-1),n[9]||=s(`span`,null,`(Guardadas localmente)`,-1)])])):d(``,!0),s(`div`,_e,[h(o(g),{onClick:Z,icon:`pi pi-refresh`,label:`Actualizar`,class:`update-btn mr-2 mt-2 last:mr-0 last:mt-0`,loading:R.value,disabled:!K.value,severity:`help`},null,8,[`loading`,`disabled`]),K.value?d(``,!0):(r(),f(o(g),{key:0,label:`Esperar ${q.value}s`,class:`cooldown-btn last:mr-0 last:mt-0`,severity:`secondary`,disabled:``},null,8,[`label`]))])])]),H.value&&b.value.length>W.value?(r(),f(o(ie),{key:0,first:U.value,rows:W.value,totalRecords:b.value.length,onPage:n[3]||=e=>{U.value=e.first,W.value=e.rows},class:`mb-4`},null,8,[`first`,`rows`,`totalRecords`])):d(``,!0),h(o(y),{class:`galactic-panel mt-6`},{header:p(()=>[...n[10]||=[s(`h2`,{class:`panel-title`},`Información del Censo`,-1)]]),default:p(()=>[s(`div`,C,[s(`p`,null,[n[12]||=m(` Total de bases registradas: `,-1),s(`strong`,null,l(b.value.length),1),b.value.length>0?(r(),c(`span`,w,[...n[11]||=[s(`i`,{class:`pi pi-cloud ml-2`},null,-1),m(` Datos en cache `,-1)]])):d(``,!0)]),s(`p`,T,[n[13]||=m(` Nivel de seguridad: `,-1),h(o(x),{value:`Clasificado RSS`,severity:`info`,class:`category-tag`})]),s(`p`,E,[m(` Última actualización: `+l(new Date().toLocaleDateString())+` `,1),n[14]||=s(`br`,null,null,-1),n[15]||=s(`small`,null,`Límite API: 2 consultas por minuto`,-1)])])]),_:1}),n[24]||=s(`br`,null,null,-1),R.value?(r(),c(`div`,D,[...n[16]||=[s(`i`,{class:`pi pi-spinner pi-spin`},null,-1),m(` Cargando bases espaciales... `,-1)]])):z.value?(r(),c(`div`,O,[n[17]||=s(`i`,{class:`pi pi-exclamation-triangle`},null,-1),m(` `+l(z.value),1)])):b.value.length===0?(r(),c(`div`,k,[...n[18]||=[s(`i`,{class:`pi pi-info-circle`},null,-1),m(` No se encontraron bases `,-1)]])):(r(),c(`div`,{key:4,class:`grid gap-4`,style:ee(`grid-template-columns: repeat(${Oe.value}, 1fr)`)},[(r(!0),c(u,null,e(Ee.value,(e,t)=>(r(),f(o(v),{key:t,class:`link-card`},{content:p(()=>[s(`div`,A,[s(`div`,j,[s(`div`,M,[s(`h3`,N,l(e.Name),1),h(o(x),{value:e.Platform,severity:`info`,class:`category-tag`},null,8,[`value`])]),s(`div`,P,[s(`div`,F,[n[19]||=s(`span`,{class:`detail-label`},`Jugador:`,-1),s(`span`,I,l(e.CensusPlayer),1)]),s(`div`,ve,[n[20]||=s(`span`,{class:`detail-label`},`Sistema:`,-1),s(`span`,ye,l(e.System),1)]),s(`div`,be,[h(o(x),{value:e.Mode,severity:`success`,class:`category-tag`},null,8,[`value`]),h(o(x),{value:`Llegada: ${e.CensusArrival}`,severity:`warning`,class:`category-tag`},null,8,[`value`]),h(o(x),{value:`Renovación: ${e.CensusRenewal}`,severity:`danger`,class:`category-tag`},null,8,[`value`])])]),e.Name?(r(),f(o(y),{key:0,class:`builder-panel mt-3`},{header:p(()=>[...n[21]||=[s(`span`,{class:`builder-link-header`},`Enlaces de la Base`,-1)]]),default:p(()=>[s(`div`,xe,[s(`a`,{href:`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`,target:`_blank`,class:`builder-link`},[...n[22]||=[s(`i`,{class:`pi pi-external-link`},null,-1),m(` Ver detalles de construcción `,-1)]],8,Se),e.imageUrl?(r(),c(`img`,{key:0,src:e.imageUrl.panel,alt:`Imagen de la base`,class:`panel-base-image`,onClick:t=>Ae(`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`)},null,8,Ce)):d(``,!0)])]),_:2},1024)):d(``,!0)])])]),_:2},1024))),128))],4))])]),_:1}),h(te,{name:`fade`},{default:p(()=>[G.value?(r(),c(`button`,{key:0,onClick:Me,class:`scroll-top-button`},[...n[25]||=[s(`i`,{class:`pi pi-arrow-up`},null,-1)]])):d(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-9de8699d`]]);export{R as default};