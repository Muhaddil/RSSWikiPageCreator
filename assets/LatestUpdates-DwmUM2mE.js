import{F as e,K as t,M as n,N as r,P as i,d as a,f as o,h as s,it as c,l,m as u,mt as d,p as ee,pt as te,t as ne,ut as f,v as p,x as re,y as m}from"./runtime-dom.esm-bundler-BxVoWjA0.js";import{t as h}from"./button-BjSjIJD1.js";import{t as ie}from"./ThemeSwitch-DPH1zOUg.js";import"./baseinput-CswjWXl7.js";import{t as ae}from"./dialog-BmEWBQxN.js";import{t as g}from"./_plugin-vue_export-helper-D6098ZHW.js";import{t as _}from"./card-BEtGBXp7.js";import{t as oe}from"./panel-DwmcN7UT.js";import{t as v}from"./logo-white-CAp0XnaH.js";import{t as se}from"./tag-B1tvXtsF.js";import{t as ce}from"./inputnumber-BFvgTsF8.js";import{a as le}from"./api-DnarUB0H.js";var ue={class:`space-page-container`},y={class:`flex items-start justify-between mb-6 header-container`},b={class:`flex flex-col`},x={class:`text-stellar-gray mt-2`},S={class:`mb-4 flex items-center gap-2`},C={class:`panel-content`},w={class:`update-info`},T={key:0,class:`loading-message`},E={key:1,class:`error-message p-error`},D={class:`p-4`},O={class:`flex flex-column gap-3`},k={class:`flex align-items-center gap-2`},A={class:`update-title`},j={class:`flex justify-between items-center mb-3`},M={class:`update-date`},N={class:`update-date-formatted`},P={key:0,class:`image-container`},F=[`src`,`alt`],I={class:`update-details`},L={class:`detail-item`},R={class:`detail-value`},z={key:0,class:`summary-box`},B={key:1,class:`fixes-box`},V={class:`fixes-preview`},H={class:`fix-text`},de={key:0,class:`fixes-actions`},fe={class:`dialog-content`},pe={class:`fixes-count`},me={class:`fixes-list-container`},he={class:`fix-number`},ge={class:`fix-content`},_e={class:`dialog-footer`},ve={class:`mt-3 flex justify-between`},ye=[`href`],be=[`href`],U=g(re({__name:`LatestUpdates`,setup(re){let g=a(()=>q.value.slice(0,K.value)),v=c({}),U=c(!0),W=c(null),G=c(window.innerWidth),K=c(10),q=c([]),J=c(!1),Y=c({}),xe=a(()=>G.value<768?1:G.value<1200?2:3),X=async()=>{try{let e=new URLSearchParams({action:`parse`,page:`Noticias`,prop:`text`,format:`json`,origin:`*`}),t=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${e.toString()}`)).json()).parse.text[`*`];Se(t)}catch(e){W.value=`Error al cargar las noticias`,console.error(e)}},Se=e=>{let t=new DOMParser,n=t.parseFromString(e,`text/html`).querySelector(`.plainlinks`);if(!n)return;let r=[],i=n.innerHTML.split(`<br>`);for(let e of i){if(!e.trim())continue;let n=t.parseFromString(e,`text/html`),i=n.querySelector(`a`);if(i){let e=i.textContent?.trim()||``,t=i.getAttribute(`href`)||``,a=decodeURIComponent(t.split(`/wiki/`).pop()||``).replace(/_/g,` `).match(/(\d+\.\d+(\.\d+)?)/),o=n.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);a&&o&&r.push({title:e,link:`https://nomanssky.fandom.com${t}`,date:o[1],version:a[1]})}}q.value=r,Ce()},Ce=async()=>{try{for(let e of g.value){let t=await we(e.link);t&&(v.value[e.version]=t)}}catch(e){console.error(`Error fetching update details:`,e)}finally{U.value=!1}},we=async e=>{try{let t=e.split(`/wiki/`)[1],n=new URLSearchParams({action:`parse`,page:decodeURIComponent(t),prop:`wikitext`,format:`json`,origin:`*`}),r=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${n.toString()}`)).json()).parse.wikitext[`*`];return Z(r,t)}catch(t){return console.error(`Error fetching details for ${e}:`,t),{}}},Te=e=>(e=e.replace(/'''/g,``),e=e.replace(/''/g,``),e=e.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,`$2`),e=e.replace(/\[\[([^\]]+)\]\]/g,`$1`),e=e.replace(/<br\s*\/?>/gi,`
`),e),Z=async(e,t)=>{let n={fixes:[]},r=e.match(/\|\s*image\s*=\s*(.+?)\n/);if(r){let e=await le(r[1].split(`
`)[0].split(`|`)[0].trim());e&&(n.image=e)}let i=e.match(/\|\s*date\s*=\s*(.+?)\n/);i&&(n.date=i[1].trim());let a=e.match(/\|\s*platform\s*=\s*(.+?)\n/);a&&(n.platforms=a[1].trim());let o=e.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);o&&(n.link=o[1].trim());let s=e.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);s&&(n.summary=Te(s[1].trim()));let c=e.match(/==\s*(?:corre(?:cci[oó]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(c){let e=c[1].matchAll(/^\*\s*(.+)$/gm);for(let t of e){let e=t[1].replace(/\s+/g,` `).trim();n.fixes?.push(e)}}return n};n(()=>{window.addEventListener(`resize`,()=>G.value=window.innerWidth),X()});let Ee=()=>{U.value=!0,W.value=null,q.value=[],v.value={},X()},Q=e=>{let t={enero:`01`,febrero:`02`,marzo:`03`,abril:`04`,mayo:`05`,junio:`06`,julio:`07`,agosto:`08`,septiembre:`09`,octubre:`10`,noviembre:`11`,diciembre:`12`},n=e.split(` de `);return n.length===3?`${n[0].padStart(2,`0`)}/${t[n[1].toLowerCase()]}/${n[2]}`:e},De=a(()=>g.value.length>0?Q(g.value[0].date):`N/A`),$=()=>{J.value=window.scrollY>300},Oe=()=>{window.scrollTo({top:0,behavior:`smooth`})};n(()=>{window.addEventListener(`scroll`,$)}),r(()=>{window.removeEventListener(`scroll`,$)});let ke=e=>{Y.value[e]=!0},Ae=e=>{Y.value[e]=!1};return(n,r)=>(i(),s(l,null,[m(f(_),{class:`p-0 galactic-card`},{content:t(()=>[o(`div`,ue,[o(`div`,y,[o(`div`,b,[r[1]||=o(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[o(`div`,{class:`wiki-logo`},[o(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`Wiki Logo`})])],-1),r[2]||=o(`div`,{class:`header-container`},[o(`div`,{class:`title-theme-container`},[o(`h1`,{class:`galactic-title`},[o(`span`,{class:`title-text`},`Actualizaciones de No Man's Sky`)])])],-1),r[3]||=o(`p`,{class:`text-stellar-gray mt-2`},`Últimas actualizaciones del juego desde la wiki oficial`,-1),o(`p`,x,[m(ie,{style:{"margin-right":`2rem`}})])])]),o(`div`,S,[r[4]||=o(`label`,{for:`maxUpdates`,class:`text-stellar-gray font-semibold`},`Mostrar hasta:`,-1),m(f(ce),{id:`maxUpdates`,modelValue:K.value,"onUpdate:modelValue":r[0]||=e=>K.value=e,min:1,max:15,showButtons:!0,inputClass:`p-inputtext-sm`,class:`mx-2`},null,8,[`modelValue`]),r[5]||=o(`span`,{class:`text-stellar-gray`},`actualizaciones`,-1),r[6]||=o(`br`,null,null,-1),r[7]||=o(`br`,null,null,-1),m(f(h),{label:`Buscar Actualizaciones`,icon:`pi pi-refresh`,class:`p-button-outlined p-button-sm`,onClick:Ee})]),m(f(oe),{class:`galactic-panel`},{header:t(()=>[...r[8]||=[o(`h2`,{class:`panel-title`},`Historial de Actualizaciones`,-1)]]),default:t(()=>[o(`div`,C,[o(`p`,null,[r[9]||=p(` Total de actualizaciones recientes: `,-1),o(`strong`,null,d(g.value.length),1)]),o(`p`,w,`Última actualización: `+d(De.value),1)])]),_:1}),r[19]||=o(`br`,null,null,-1),U.value?(i(),s(`div`,T,[...r[10]||=[o(`i`,{class:`pi pi-spinner pi-spin`},null,-1),p(` Cargando actualizaciones... `,-1)]])):W.value?(i(),s(`div`,E,[r[11]||=o(`i`,{class:`pi pi-exclamation-triangle`},null,-1),p(` `+d(W.value),1)])):(i(),s(`div`,{key:2,class:`grid gap-4`,style:te(`grid-template-columns: repeat(${xe.value}, 1fr)`)},[(i(!0),s(l,null,e(g.value,(n,a)=>(i(),ee(f(_),{key:a,class:`update-card`},{content:t(()=>[o(`div`,D,[o(`div`,O,[o(`div`,k,[o(`h3`,A,d(n.title),1),m(f(se),{value:n.version,severity:`info`,class:`version-tag`},null,8,[`value`])]),o(`div`,j,[o(`span`,M,d(n.date),1),o(`span`,N,d(Q(n.date)),1)]),v.value[n.version]?.image?(i(),s(`div`,P,[o(`img`,{src:v.value[n.version]?.image?.panel,alt:n.title,class:`update-image`},null,8,F)])):u(``,!0),o(`div`,I,[o(`div`,L,[r[12]||=o(`span`,{class:`detail-label`},`Plataformas:`,-1),o(`span`,R,d(v.value[n.version]?.platforms||`Todas`),1)]),v.value[n.version]?.summary?(i(),s(`div`,z,[r[13]||=o(`span`,{class:`detail-label`},`Resumen:`,-1),o(`p`,null,d(v.value[n.version]?.summary),1)])):u(``,!0),v.value[n.version]?.fixes&&v.value[n.version]?.fixes.length>0?(i(),s(`div`,B,[r[16]||=o(`div`,{class:`fixes-header`},[o(`i`,{class:`pi pi-wrench fixes-icon`}),o(`span`,{class:`detail-label`},`Correcciones principales:`)],-1),o(`div`,V,[(i(!0),s(l,null,e(v.value[n.version]?.fixes?.slice(0,3),(e,t)=>(i(),s(`div`,{key:t,class:`fix-item`},[r[14]||=o(`div`,{class:`fix-bullet`},null,-1),o(`span`,H,d(e),1)]))),128))]),v.value[n.version]?.fixes.length>3?(i(),s(`div`,de,[m(f(h),{label:`Ver todas (${v.value[n.version]?.fixes.length})`,icon:`pi pi-list`,class:`p-button-text p-button-sm view-all-btn`,onClick:e=>ke(n.version)},null,8,[`label`,`onClick`])])):u(``,!0),m(f(ae),{visible:Y.value[n.version],"onUpdate:visible":e=>Y.value[n.version]=e,header:`Correcciones completas - Versión ${n.version}`,modal:``,closable:!1,dismissableMask:``,class:`fixes-dialog`,style:{width:`90vw`,maxWidth:`800px`}},{footer:t(()=>[o(`div`,_e,[m(f(h),{label:`Cerrar`,icon:`pi pi-times`,class:`p-button-outlined`,onClick:e=>Ae(n.version)},null,8,[`onClick`])])]),default:t(()=>[o(`div`,fe,[o(`div`,pe,[r[15]||=o(`i`,{class:`pi pi-info-circle`},null,-1),o(`span`,null,`Total de correcciones: `+d(v.value[n.version]?.fixes?.length),1)]),o(`div`,me,[(i(!0),s(l,null,e(v.value[n.version]?.fixes,(e,t)=>(i(),s(`div`,{key:t,class:`dialog-fix-item`},[o(`div`,he,d(t+1),1),o(`div`,ge,d(e),1)]))),128))])])]),_:2},1032,[`visible`,`onUpdate:visible`,`header`])])):u(``,!0),o(`div`,ve,[o(`a`,{href:n.link,target:`_blank`,class:`wiki-link`},[...r[17]||=[o(`i`,{class:`pi pi-book`},null,-1),p(` Ver en wiki `,-1)]],8,ye),v.value[n.version]?.link?(i(),s(`a`,{key:0,href:v.value[n.version]?.link,target:`_blank`,class:`official-link`},[...r[18]||=[o(`i`,{class:`pi pi-globe`},null,-1),p(` Nota oficial `,-1)]],8,be)):u(``,!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),m(ne,{name:`fade`},{default:t(()=>[J.value?(i(),s(`button`,{key:0,onClick:Oe,class:`scroll-top-button`},[...r[20]||=[o(`i`,{class:`pi pi-arrow-up`},null,-1)]])):u(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-5f0dda4a`]]);export{U as default};