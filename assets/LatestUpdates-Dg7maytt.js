import{A as e,At as t,D as n,E as r,W as i,_ as a,c as o,ct as s,h as c,k as l,kt as ee,l as u,m as d,nt as f,o as p,r as m,s as h,u as g}from"./runtime-core.esm-bundler-DchWbIG6.js";import{t as te}from"./runtime-dom.esm-bundler-BLbTed6u.js";import{t as _}from"./button-B2IlAsp7.js";import"./portal-DzRr4Kdd.js";import"./dist-D83Mqt5P.js";import{t as ne}from"./ThemeSwitch-7FKpsrsT.js";import"./baseinput-DGGDxDlI.js";import"./inputtext-8SA5CJIi.js";import{t as re}from"./dialog-3HNEvjqt.js";import{t as v}from"./_plugin-vue_export-helper-DyZRSbhD.js";import{t as y}from"./card-BcBQ0oRB.js";import"./minus-B1GCgViL.js";import{t as ie}from"./panel-DiGYrp7H.js";import{t as b}from"./logo-white-BFvoBgAm.js";import{t as ae}from"./tag-D6U4rC1k.js";import{t as oe}from"./inputnumber-BN8I_kfg.js";import{a as se}from"./api-ChuPdH1F.js";var ce={class:`space-page-container`},le={class:`flex items-start justify-between mb-6 header-container`},ue={class:`flex flex-col`},de={class:`text-stellar-gray mt-2`},x={class:`mb-4 flex items-center gap-2`},S={class:`panel-content`},C={class:`update-info`},w={key:0,class:`loading-message`},T={key:1,class:`error-message p-error`},E={class:`p-4`},D={class:`flex flex-column gap-3`},O={class:`flex align-items-center gap-2`},k={class:`update-title`},A={class:`flex justify-between items-center mb-3`},j={class:`update-date`},M={class:`update-date-formatted`},N={key:0,class:`image-container`},P=[`src`,`alt`],F={class:`update-details`},I={class:`detail-item`},L={class:`detail-value`},R={key:0,class:`summary-box`},z={key:1,class:`fixes-box`},B={class:`fixes-preview`},V={class:`fix-text`},H={key:0,class:`fixes-actions`},fe={class:`dialog-content`},pe={class:`fixes-count`},me={class:`fixes-list-container`},he={class:`fix-number`},ge={class:`fix-content`},_e={class:`dialog-footer`},ve={class:`mt-3 flex justify-between`},ye=[`href`],be=[`href`],U=v(a({__name:`LatestUpdates`,setup(a){let v=p(()=>q.value.slice(0,K.value)),b=f({}),U=f(!0),W=f(null),G=f(window.innerWidth),K=f(10),q=f([]),J=f(!1),Y=f({}),xe=p(()=>G.value<768?1:G.value<1200?2:3),X=async()=>{try{let e=new URLSearchParams({action:`parse`,page:`Noticias`,prop:`text`,format:`json`,origin:`*`}),t=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${e.toString()}`)).json()).parse.text[`*`];Se(t)}catch(e){W.value=`Error al cargar las noticias`,console.error(e)}},Se=e=>{let t=new DOMParser,n=t.parseFromString(e,`text/html`).querySelector(`.plainlinks`);if(!n)return;let r=[],i=n.innerHTML.split(`<br>`);for(let e of i){if(!e.trim())continue;let n=t.parseFromString(e,`text/html`),i=n.querySelector(`a`);if(i){let e=i.textContent?.trim()||``,t=i.getAttribute(`href`)||``,a=decodeURIComponent(t.split(`/wiki/`).pop()||``).replace(/_/g,` `).match(/(\d+\.\d+(\.\d+)?)/),o=n.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);a&&o&&r.push({title:e,link:`https://nomanssky.fandom.com${t}`,date:o[1],version:a[1]})}}q.value=r,Ce()},Ce=async()=>{try{for(let e of v.value){let t=await we(e.link);t&&(b.value[e.version]=t)}}catch(e){console.error(`Error fetching update details:`,e)}finally{U.value=!1}},we=async e=>{try{let t=e.split(`/wiki/`)[1],n=new URLSearchParams({action:`parse`,page:decodeURIComponent(t),prop:`wikitext`,format:`json`,origin:`*`}),r=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${n.toString()}`)).json()).parse.wikitext[`*`];return Z(r,t)}catch(t){return console.error(`Error fetching details for ${e}:`,t),{}}},Te=e=>(e=e.replace(/'''/g,``),e=e.replace(/''/g,``),e=e.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,`$2`),e=e.replace(/\[\[([^\]]+)\]\]/g,`$1`),e=e.replace(/<br\s*\/?>/gi,`
`),e),Z=async(e,t)=>{let n={fixes:[]},r=e.match(/\|\s*image\s*=\s*(.+?)\n/);if(r){let e=await se(r[1].split(`
`)[0].split(`|`)[0].trim());e&&(n.image=e)}let i=e.match(/\|\s*date\s*=\s*(.+?)\n/);i&&(n.date=i[1].trim());let a=e.match(/\|\s*platform\s*=\s*(.+?)\n/);a&&(n.platforms=a[1].trim());let o=e.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);o&&(n.link=o[1].trim());let s=e.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);s&&(n.summary=Te(s[1].trim()));let c=e.match(/==\s*(?:corre(?:cci[oó]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(c){let e=c[1].matchAll(/^\*\s*(.+)$/gm);for(let t of e){let e=t[1].replace(/\s+/g,` `).trim();n.fixes?.push(e)}}return n};r(()=>{window.addEventListener(`resize`,()=>G.value=window.innerWidth),X()});let Ee=()=>{U.value=!0,W.value=null,q.value=[],b.value={},X()},Q=e=>{let t={enero:`01`,febrero:`02`,marzo:`03`,abril:`04`,mayo:`05`,junio:`06`,julio:`07`,agosto:`08`,septiembre:`09`,octubre:`10`,noviembre:`11`,diciembre:`12`},n=e.split(` de `);return n.length===3?`${n[0].padStart(2,`0`)}/${t[n[1].toLowerCase()]}/${n[2]}`:e},De=p(()=>v.value.length>0?Q(v.value[0].date):`N/A`),$=()=>{J.value=window.scrollY>300},Oe=()=>{window.scrollTo({top:0,behavior:`smooth`})};r(()=>{window.addEventListener(`scroll`,$)}),n(()=>{window.removeEventListener(`scroll`,$)});let ke=e=>{Y.value[e]=!0},Ae=e=>{Y.value[e]=!1};return(n,r)=>(l(),g(m,null,[c(s(y),{class:`p-0 galactic-card`},{content:i(()=>[h(`div`,ce,[h(`div`,le,[h(`div`,ue,[r[1]||=h(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[h(`div`,{class:`wiki-logo`},[h(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`Wiki Logo`})])],-1),r[2]||=h(`div`,{class:`header-container`},[h(`div`,{class:`title-theme-container`},[h(`h1`,{class:`galactic-title`},[h(`span`,{class:`title-text`},`Actualizaciones de No Man's Sky`)])])],-1),r[3]||=h(`p`,{class:`text-stellar-gray mt-2`},`Últimas actualizaciones del juego desde la wiki oficial`,-1),h(`p`,de,[c(ne,{style:{"margin-right":`2rem`}})])])]),h(`div`,x,[r[4]||=h(`label`,{for:`maxUpdates`,class:`text-stellar-gray font-semibold`},`Mostrar hasta:`,-1),c(s(oe),{id:`maxUpdates`,modelValue:K.value,"onUpdate:modelValue":r[0]||=e=>K.value=e,min:1,max:15,showButtons:!0,inputClass:`p-inputtext-sm`,class:`mx-2`},null,8,[`modelValue`]),r[5]||=h(`span`,{class:`text-stellar-gray`},`actualizaciones`,-1),r[6]||=h(`br`,null,null,-1),r[7]||=h(`br`,null,null,-1),c(s(_),{label:`Buscar Actualizaciones`,icon:`pi pi-refresh`,class:`p-button-outlined p-button-sm`,onClick:Ee})]),c(s(ie),{class:`galactic-panel`},{header:i(()=>[...r[8]||=[h(`h2`,{class:`panel-title`},`Historial de Actualizaciones`,-1)]]),default:i(()=>[h(`div`,S,[h(`p`,null,[r[9]||=d(` Total de actualizaciones recientes: `,-1),h(`strong`,null,t(v.value.length),1)]),h(`p`,C,`Última actualización: `+t(De.value),1)])]),_:1}),r[19]||=h(`br`,null,null,-1),U.value?(l(),g(`div`,w,[...r[10]||=[h(`i`,{class:`pi pi-spinner pi-spin`},null,-1),d(` Cargando actualizaciones... `,-1)]])):W.value?(l(),g(`div`,T,[r[11]||=h(`i`,{class:`pi pi-exclamation-triangle`},null,-1),d(` `+t(W.value),1)])):(l(),g(`div`,{key:2,class:`grid gap-4`,style:ee(`grid-template-columns: repeat(${xe.value}, 1fr)`)},[(l(!0),g(m,null,e(v.value,(n,a)=>(l(),o(s(y),{key:a,class:`update-card`},{content:i(()=>[h(`div`,E,[h(`div`,D,[h(`div`,O,[h(`h3`,k,t(n.title),1),c(s(ae),{value:n.version,severity:`info`,class:`version-tag`},null,8,[`value`])]),h(`div`,A,[h(`span`,j,t(n.date),1),h(`span`,M,t(Q(n.date)),1)]),b.value[n.version]?.image?(l(),g(`div`,N,[h(`img`,{src:b.value[n.version]?.image?.panel,alt:n.title,class:`update-image`},null,8,P)])):u(``,!0),h(`div`,F,[h(`div`,I,[r[12]||=h(`span`,{class:`detail-label`},`Plataformas:`,-1),h(`span`,L,t(b.value[n.version]?.platforms||`Todas`),1)]),b.value[n.version]?.summary?(l(),g(`div`,R,[r[13]||=h(`span`,{class:`detail-label`},`Resumen:`,-1),h(`p`,null,t(b.value[n.version]?.summary),1)])):u(``,!0),b.value[n.version]?.fixes&&b.value[n.version]?.fixes.length>0?(l(),g(`div`,z,[r[16]||=h(`div`,{class:`fixes-header`},[h(`i`,{class:`pi pi-wrench fixes-icon`}),h(`span`,{class:`detail-label`},`Correcciones principales:`)],-1),h(`div`,B,[(l(!0),g(m,null,e(b.value[n.version]?.fixes?.slice(0,3),(e,n)=>(l(),g(`div`,{key:n,class:`fix-item`},[r[14]||=h(`div`,{class:`fix-bullet`},null,-1),h(`span`,V,t(e),1)]))),128))]),b.value[n.version]?.fixes.length>3?(l(),g(`div`,H,[c(s(_),{label:`Ver todas (${b.value[n.version]?.fixes.length})`,icon:`pi pi-list`,class:`p-button-text p-button-sm view-all-btn`,onClick:e=>ke(n.version)},null,8,[`label`,`onClick`])])):u(``,!0),c(s(re),{visible:Y.value[n.version],"onUpdate:visible":e=>Y.value[n.version]=e,header:`Correcciones completas - Versión ${n.version}`,modal:``,closable:!1,dismissableMask:``,class:`fixes-dialog`,style:{width:`90vw`,maxWidth:`800px`}},{footer:i(()=>[h(`div`,_e,[c(s(_),{label:`Cerrar`,icon:`pi pi-times`,class:`p-button-outlined`,onClick:e=>Ae(n.version)},null,8,[`onClick`])])]),default:i(()=>[h(`div`,fe,[h(`div`,pe,[r[15]||=h(`i`,{class:`pi pi-info-circle`},null,-1),h(`span`,null,`Total de correcciones: `+t(b.value[n.version]?.fixes?.length),1)]),h(`div`,me,[(l(!0),g(m,null,e(b.value[n.version]?.fixes,(e,n)=>(l(),g(`div`,{key:n,class:`dialog-fix-item`},[h(`div`,he,t(n+1),1),h(`div`,ge,t(e),1)]))),128))])])]),_:2},1032,[`visible`,`onUpdate:visible`,`header`])])):u(``,!0),h(`div`,ve,[h(`a`,{href:n.link,target:`_blank`,class:`wiki-link`},[...r[17]||=[h(`i`,{class:`pi pi-book`},null,-1),d(` Ver en wiki `,-1)]],8,ye),b.value[n.version]?.link?(l(),g(`a`,{key:0,href:b.value[n.version]?.link,target:`_blank`,class:`official-link`},[...r[18]||=[h(`i`,{class:`pi pi-globe`},null,-1),d(` Nota oficial `,-1)]],8,be)):u(``,!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),c(te,{name:`fade`},{default:i(()=>[J.value?(l(),g(`button`,{key:0,onClick:Oe,class:`scroll-top-button`},[...r[20]||=[h(`i`,{class:`pi pi-arrow-up`},null,-1)]])):u(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-5f0dda4a`]]);export{U as default};