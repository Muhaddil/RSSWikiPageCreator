const R=new Set,f=new WeakMap,T=new WeakMap,y=new WeakMap,A=new WeakMap,q=new WeakMap,M=new WeakMap,N=new WeakMap,x=new WeakSet;let g,k=0,$=0;const p="__aa_tgt",W="__aa_del",S="__aa_new",Q=e=>{const t=Z(e);t&&t.forEach((e=>ee(e)))},U=e=>{e.forEach((e=>{e.target===g&&V(),f.has(e.target)&&b(e.target)}))};function G(e){const t=A.get(e);null==t||t.disconnect();let n=f.get(e),o=0;n||(n=O(e),f.set(e,n));const{offsetWidth:i,offsetHeight:r}=g,a=[n.top-5,i-(n.left+5+n.width),r-(n.top+5+n.height),n.left-5].map((e=>-1*Math.floor(e)+"px")).join(" "),s=new IntersectionObserver((()=>{++o>1&&b(e)}),{root:g,threshold:1,rootMargin:a});s.observe(e),A.set(e,s)}function b(e){clearTimeout(N.get(e));const t=P(e),n=C(t)?500:t.duration;N.set(e,setTimeout((async()=>{const t=y.get(e);try{await(null==t?void 0:t.finished),f.set(e,O(e)),G(e)}catch{}}),n))}function V(){clearTimeout(N.get(g)),N.set(g,setTimeout((()=>{R.forEach((e=>I(e,(e=>D((()=>b(e)))))))}),100))}function J(e){setTimeout((()=>{q.set(e,setInterval((()=>D(b.bind(null,e))),2e3))}),Math.round(2e3*Math.random()))}function D(e){"function"==typeof requestIdleCallback?requestIdleCallback((()=>e())):requestAnimationFrame((()=>e()))}let _,E;const K=typeof window<"u"&&"ResizeObserver"in window;function Z(e){return!e.reduce(((e,t)=>[...e,...Array.from(t.addedNodes),...Array.from(t.removedNodes)]),[]).every((e=>"#comment"===e.nodeName))&&e.reduce(((e,t)=>{if(!1===e)return!1;if(t.target instanceof Element){if(L(t.target),!e.has(t.target)){e.add(t.target);for(let n=0;n<t.target.children.length;n++){const o=t.target.children.item(n);if(o){if(W in o)return!1;L(t.target,o),e.add(o)}}}if(t.removedNodes.length)for(let n=0;n<t.removedNodes.length;n++){const o=t.removedNodes[n];if(W in o)return!1;o instanceof Element&&(e.add(o),L(t.target,o),T.set(o,[t.previousSibling,t.nextSibling]))}}return e}),new Set)}function L(e,t){t||p in e?t&&!(p in t)&&Object.defineProperty(t,p,{value:e}):Object.defineProperty(e,p,{value:e})}function ee(e){var t;const n=e.isConnected,o=f.has(e);n&&T.has(e)&&T.delete(e),y.has(e)&&(null===(t=y.get(e))||void 0===t||t.cancel()),S in e?X(e):o&&n?ne(e):o&&!n?oe(e):X(e)}function h(e){return Number(e.replace(/[^0-9.\-]/g,""))}function te(e){let t=e.parentElement;for(;t;){if(t.scrollLeft||t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};t=t.parentElement}return{x:0,y:0}}function O(e){const t=e.getBoundingClientRect(),{x:n,y:o}=te(e);return{top:t.top+o,left:t.left+n,width:t.width,height:t.height}}function H(e,t,n){let o=t.width,i=t.height,r=n.width,a=n.height;const s=getComputedStyle(e);if("content-box"===s.getPropertyValue("box-sizing")){const e=h(s.paddingTop)+h(s.paddingBottom)+h(s.borderTopWidth)+h(s.borderBottomWidth),t=h(s.paddingLeft)+h(s.paddingRight)+h(s.borderRightWidth)+h(s.borderLeftWidth);o-=t,r-=t,i-=e,a-=e}return[o,r,i,a].map(Math.round)}function P(e){return p in e&&M.has(e[p])?M.get(e[p]):{duration:250,easing:"ease-in-out"}}function F(e){if(p in e)return e[p]}function j(e){const t=F(e);return!!t&&x.has(t)}function I(e,...t){t.forEach((t=>t(e,M.has(e))));for(let n=0;n<e.children.length;n++){const o=e.children.item(n);o&&t.forEach((e=>e(o,M.has(o))))}}function z(e){return Array.isArray(e)?e:[e]}function C(e){return"function"==typeof e}function ne(e){const t=f.get(e),n=O(e);if(!j(e))return f.set(e,n);let o;if(!t)return;const i=P(e);if("function"!=typeof i){const r=t.left-n.left,a=t.top-n.top,[s,l,d,c]=H(e,t,n),f={transform:`translate(${r}px, ${a}px)`},u={transform:"translate(0, 0)"};s!==l&&(f.width=`${s}px`,u.width=`${l}px`),d!==c&&(f.height=`${d}px`,u.height=`${c}px`),o=e.animate([f,u],{duration:i.duration,easing:i.easing})}else{const[r]=z(i(e,"remain",t,n));o=new Animation(r),o.play()}y.set(e,o),f.set(e,n),o.addEventListener("finish",b.bind(null,e))}function X(e){S in e&&delete e[S];const t=O(e);f.set(e,t);const n=P(e);if(!j(e))return;let o;if("function"!=typeof n)o=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:1.5*n.duration,easing:"ease-in"});else{const[i]=z(n(e,"add",t));o=new Animation(i),o.play()}y.set(e,o),o.addEventListener("finish",b.bind(null,e))}function Y(e,t){var n;e.remove(),f.delete(e),T.delete(e),y.delete(e),null===(n=A.get(e))||void 0===n||n.disconnect(),setTimeout((()=>{if(W in e&&delete e[W],Object.defineProperty(e,S,{value:!0,configurable:!0}),t&&e instanceof HTMLElement)for(const n in t)e.style[n]=""}),0)}function oe(e){var t;if(!T.has(e)||!f.has(e))return;const[n,o]=T.get(e);Object.defineProperty(e,W,{value:!0,configurable:!0});const i=window.scrollX,r=window.scrollY;if(o&&o.parentNode&&o.parentNode instanceof Element?o.parentNode.insertBefore(e,o):n&&n.parentNode?n.parentNode.appendChild(e):null===(t=F(e))||void 0===t||t.appendChild(e),!j(e))return Y(e);const[a,s,l,d]=se(e),c=P(e),u=f.get(e);(i!==k||r!==$)&&ie(e,i,r,c);let p,h={position:"absolute",top:`${a}px`,left:`${s}px`,width:`${l}px`,height:`${d}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(C(c)){const[t,n]=z(c(e,"remove",u));!1!==(null==n?void 0:n.styleReset)&&(h=(null==n?void 0:n.styleReset)||h,Object.assign(e.style,h)),p=new Animation(t),p.play()}else Object.assign(e.style,h),p=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:c.duration,easing:"ease-out"});y.set(e,p),p.addEventListener("finish",Y.bind(null,e,h))}function ie(e,t,n,o){const i=k-t,r=$-n,a=document.documentElement.style.scrollBehavior;if("smooth"===getComputedStyle(g).scrollBehavior&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+i,window.scrollY+r),!e.parentElement)return;const s=e.parentElement;let l=s.clientHeight,d=s.clientWidth;const c=performance.now();!function e(){requestAnimationFrame((()=>{if(!C(o)){const t=l-s.clientHeight,n=d-s.clientWidth;c+o.duration>performance.now()?(window.scrollTo({left:window.scrollX-n,top:window.scrollY-t}),l=s.clientHeight,d=s.clientWidth,e()):document.documentElement.style.scrollBehavior=a}}))}()}function se(e){const t=f.get(e),[n,,o]=H(e,t,O(e));let i=e.parentElement;for(;i&&("static"===getComputedStyle(i).position||i instanceof HTMLBodyElement);)i=i.parentElement;i||(i=document.body);const r=getComputedStyle(i),a=f.get(i)||O(i);return[Math.round(t.top-a.top)-h(r.borderTopWidth),Math.round(t.left-a.left)-h(r.borderLeftWidth),n,o]}function re(e,t={}){return _&&E&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!C(t)&&!t.disrespectUserMotionPreference||(x.add(e),"static"===getComputedStyle(e).position&&Object.assign(e.style,{position:"relative"}),I(e,b,J,(e=>null==E?void 0:E.observe(e))),C(t)?M.set(e,t):M.set(e,{duration:250,easing:"ease-in-out",...t}),_.observe(e,{childList:!0}),R.add(e))),Object.freeze({parent:e,enable:()=>{x.add(e)},disable:()=>{x.delete(e)},isEnabled:()=>x.has(e)})}K&&(g=document.documentElement,_=new MutationObserver(Q),E=new ResizeObserver(U),window.addEventListener("scroll",(()=>{$=window.scrollY,k=window.scrollX})),E.observe(g));export{re as a};
