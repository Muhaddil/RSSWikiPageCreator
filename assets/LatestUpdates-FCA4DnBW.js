"use strict";import{d as K,c as R,r as m,x as N,y as Q,a as n,o as t,f as u,k as f,b as e,b3 as X,h as d,Z as A,g as y,t as c,B as ss,F as S,H as E,j as es,e as x,P as as,a9 as ls,p as is}from"./main-WhmDEAp0.js";import{_ as ts}from"./logo-white-CwkOOWqZ.js";import{s as W}from"./index-C9GXlweG.js";import{s as ns}from"./index-BmofN7sc.js";import{s as os}from"./index-BjVuhrDD.js";import{s as rs}from"./index-V1xKN6_0.js";import{g as cs}from"./api-Bbdr4r4D.js";import"./index-CSioWivY.js";const ps={class:"space-page-container"},us={class:"flex items-start justify-between mb-6 header-container"},ds={class:"flex flex-col"},ms={class:"text-stellar-gray mt-2"},vs={class:"mb-4 flex items-center gap-2"},fs={class:"panel-content"},gs={class:"update-info"},hs={key:0,class:"loading-message"},xs={key:1,class:"error-message p-error"},bs={class:"p-4"},ks={class:"flex flex-column gap-3"},ys={class:"flex align-items-center gap-2"},ws={class:"update-title"},Cs={class:"flex justify-between items-center mb-3"},_s={class:"update-date"},$s={class:"update-date-formatted"},Ss={key:0,class:"image-container"},js=["src","alt"],zs={class:"update-details"},Us={class:"detail-item"},Ls={class:"detail-value"},Rs={key:0,class:"summary-box"},As={key:1,class:"fixes-box"},Es={class:"fixes-preview"},Vs={class:"fix-text"},Ms={key:0,class:"fixes-actions"},Ps={class:"dialog-content"},Ts={class:"fixes-count"},Ns={class:"fixes-list-container"},Ws={class:"fix-number"},Bs={class:"fix-content"},Fs={class:"dialog-footer"},Hs={class:"mt-3 flex justify-between"},Is=["href"],qs=["href"],Ds=K({__name:"LatestUpdates",setup(Ys){const b=R(()=>L.value.slice(0,U.value)),i=m({}),j=m(!0),w=m(null),z=m(window.innerWidth),U=m(10),L=m([]),V=m(!1),C=m({}),B=R(()=>z.value<768?1:z.value<1200?2:3),M=async()=>{try{const l=new URLSearchParams({action:"parse",page:"Noticias",prop:"text",format:"json",origin:"*"}),s=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${l.toString()}`)).json()).parse.text["*"];F(s)}catch(l){w.value="Error al cargar las noticias",console.error(l)}},F=l=>{const s=new DOMParser,a=s.parseFromString(l,"text/html").querySelector(".plainlinks");if(!a)return;const p=[],o=a.innerHTML.split("<br>");for(const r of o){if(!r.trim())continue;const k=s.parseFromString(r,"text/html"),g=k.querySelector("a");if(g){const _=g.textContent?.trim()||"",h=g.getAttribute("href")||"",v=decodeURIComponent(h.split("/wiki/").pop()||"").replace(/_/g," ").match(/(\d+\.\d+(\.\d+)?)/),$=k.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);v&&$&&p.push({title:_,link:`https://nomanssky.fandom.com${h}`,date:$[1],version:v[1]})}}L.value=p,H()},H=async()=>{try{for(const l of b.value){const s=await I(l.link);s&&(i.value[l.version]=s)}}catch(l){console.error("Error fetching update details:",l)}finally{j.value=!1}},I=async l=>{try{const s=l.split("/wiki/")[1],a=new URLSearchParams({action:"parse",page:decodeURIComponent(s),prop:"wikitext",format:"json",origin:"*"}),p=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${a.toString()}`)).json()).parse.wikitext["*"];return D(p,s)}catch(s){return console.error(`Error fetching details for ${l}:`,s),{}}},q=l=>(l=l.replace(/'''/g,""),l=l.replace(/''/g,""),l=l.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,"$2"),l=l.replace(/\[\[([^\]]+)\]\]/g,"$1"),l=l.replace(/<br\s*\/?>/gi,`
`),l),D=async(l,s)=>{const a={fixes:[]},p=l.match(/\|\s*image\s*=\s*(.+?)\n/);if(p){const h=p[1].split(`
`)[0].split("|")[0].trim(),v=await cs(h);v&&(a.image=v)}const o=l.match(/\|\s*date\s*=\s*(.+?)\n/);o&&(a.date=o[1].trim());const r=l.match(/\|\s*platform\s*=\s*(.+?)\n/);r&&(a.platforms=r[1].trim());const k=l.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);k&&(a.link=k[1].trim());const g=l.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);g&&(a.summary=q(g[1].trim()));const _=l.match(/==\s*(?:corre(?:cci[oÃ³]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(_){const h=_[1].matchAll(/\*\s*(.+?)(?=\n\*|\n$)/g);for(const v of h){const $=v[1].replace(/\s+/g," ").trim();a.fixes?.push($)}}return a};N(()=>{window.addEventListener("resize",()=>z.value=window.innerWidth),M()});const O=()=>{j.value=!0,w.value=null,L.value=[],i.value={},M()},P=l=>{const s={enero:"01",febrero:"02",marzo:"03",abril:"04",mayo:"05",junio:"06",julio:"07",agosto:"08",septiembre:"09",octubre:"10",noviembre:"11",diciembre:"12"},a=l.split(" de ");if(a.length===3){const p=a[0].padStart(2,"0"),o=s[a[1].toLowerCase()],r=a[2];return`${p}/${o}/${r}`}return l},Y=R(()=>b.value.length>0?P(b.value[0].date):"N/A"),T=()=>{V.value=window.scrollY>300},Z=()=>{window.scrollTo({top:0,behavior:"smooth"})};N(()=>{window.addEventListener("scroll",T)}),Q(()=>{window.removeEventListener("scroll",T)});const G=l=>{C.value[l]=!0},J=l=>{C.value[l]=!1};return(l,s)=>(t(),n(S,null,[u(d(W),{class:"p-0 galactic-card"},{content:f(()=>[e("div",ps,[e("div",us,[e("div",ds,[s[1]||(s[1]=e("a",{href:"https://nomanssky.fandom.com/es/wiki/Royal_Space_Society",target:"_blank"},[e("div",{class:"wiki-logo"},[e("img",{src:ts,class:"logo-image",alt:"Wiki Logo"})])],-1)),s[2]||(s[2]=e("div",{class:"header-container"},[e("div",{class:"title-theme-container"},[e("h1",{class:"galactic-title"},[e("span",{class:"title-text"},"Actualizaciones de No Man's Sky")])])],-1)),s[3]||(s[3]=e("p",{class:"text-stellar-gray mt-2"},"\xDAltimas actualizaciones del juego desde la wiki oficial",-1)),e("p",ms,[u(X,{style:{"margin-right":"2rem"}})])])]),e("div",vs,[s[4]||(s[4]=e("label",{for:"maxUpdates",class:"text-stellar-gray font-semibold"},"Mostrar hasta:",-1)),u(d(rs),{id:"maxUpdates",modelValue:U.value,"onUpdate:modelValue":s[0]||(s[0]=a=>U.value=a),min:1,max:15,showButtons:!0,inputClass:"p-inputtext-sm",class:"mx-2"},null,8,["modelValue"]),s[5]||(s[5]=e("span",{class:"text-stellar-gray"},"actualizaciones",-1)),s[6]||(s[6]=e("br",null,null,-1)),s[7]||(s[7]=e("br",null,null,-1)),u(d(A),{label:"Buscar Actualizaciones",icon:"pi pi-refresh",class:"p-button-outlined p-button-sm",onClick:O})]),u(d(os),{class:"galactic-panel"},{header:f(()=>[...s[8]||(s[8]=[e("h2",{class:"panel-title"},"Historial de Actualizaciones",-1)])]),default:f(()=>[e("div",fs,[e("p",null,[s[9]||(s[9]=y(" Total de actualizaciones recientes: ",-1)),e("strong",null,c(b.value.length),1)]),e("p",gs,"\xDAltima actualizaci\xF3n: "+c(Y.value),1)])]),_:1}),s[19]||(s[19]=e("br",null,null,-1)),j.value?(t(),n("div",hs,[...s[10]||(s[10]=[e("i",{class:"pi pi-spinner pi-spin"},null,-1),y(" Cargando actualizaciones... ",-1)])])):w.value?(t(),n("div",xs,[s[11]||(s[11]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),y(" "+c(w.value),1)])):(t(),n("div",{key:2,class:"grid gap-4",style:ss(`grid-template-columns: repeat(${B.value}, 1fr)`)},[(t(!0),n(S,null,E(b.value,(a,p)=>(t(),es(d(W),{key:p,class:"update-card"},{content:f(()=>[e("div",bs,[e("div",ks,[e("div",ys,[e("h3",ws,c(a.title),1),u(d(ns),{value:a.version,severity:"info",class:"version-tag"},null,8,["value"])]),e("div",Cs,[e("span",_s,c(a.date),1),e("span",$s,c(P(a.date)),1)]),i.value[a.version]?.image?(t(),n("div",Ss,[e("img",{src:i.value[a.version]?.image?.panel,alt:a.title,class:"update-image"},null,8,js)])):x("",!0),e("div",zs,[e("div",Us,[s[12]||(s[12]=e("span",{class:"detail-label"},"Plataformas:",-1)),e("span",Ls,c(i.value[a.version]?.platforms||"Todas"),1)]),i.value[a.version]?.summary?(t(),n("div",Rs,[s[13]||(s[13]=e("span",{class:"detail-label"},"Resumen:",-1)),e("p",null,c(i.value[a.version]?.summary),1)])):x("",!0),i.value[a.version]?.fixes&&i.value[a.version]?.fixes.length>0?(t(),n("div",As,[s[16]||(s[16]=e("div",{class:"fixes-header"},[e("i",{class:"pi pi-wrench fixes-icon"}),e("span",{class:"detail-label"},"Correcciones principales:")],-1)),e("div",Es,[(t(!0),n(S,null,E(i.value[a.version]?.fixes?.slice(0,3),(o,r)=>(t(),n("div",{key:r,class:"fix-item"},[s[14]||(s[14]=e("div",{class:"fix-bullet"},null,-1)),e("span",Vs,c(o),1)]))),128))]),i.value[a.version]?.fixes.length>3?(t(),n("div",Ms,[u(d(A),{label:`Ver todas (${i.value[a.version]?.fixes.length})`,icon:"pi pi-list",class:"p-button-text p-button-sm view-all-btn",onClick:o=>G(a.version)},null,8,["label","onClick"])])):x("",!0),u(d(as),{visible:C.value[a.version],"onUpdate:visible":o=>C.value[a.version]=o,header:`Correcciones completas - Versi\xF3n ${a.version}`,modal:"",closable:!1,dismissableMask:"",class:"fixes-dialog",style:{width:"90vw",maxWidth:"800px"}},{footer:f(()=>[e("div",Fs,[u(d(A),{label:"Cerrar",icon:"pi pi-times",class:"p-button-outlined",onClick:o=>J(a.version)},null,8,["onClick"])])]),default:f(()=>[e("div",Ps,[e("div",Ts,[s[15]||(s[15]=e("i",{class:"pi pi-info-circle"},null,-1)),e("span",null,"Total de correcciones: "+c(i.value[a.version]?.fixes?.length),1)]),e("div",Ns,[(t(!0),n(S,null,E(i.value[a.version]?.fixes,(o,r)=>(t(),n("div",{key:r,class:"dialog-fix-item"},[e("div",Ws,c(r+1),1),e("div",Bs,c(o),1)]))),128))])])]),_:2},1032,["visible","onUpdate:visible","header"])])):x("",!0),e("div",Hs,[e("a",{href:a.link,target:"_blank",class:"wiki-link"},[...s[17]||(s[17]=[e("i",{class:"pi pi-book"},null,-1),y(" Ver en wiki ",-1)])],8,Is),i.value[a.version]?.link?(t(),n("a",{key:0,href:i.value[a.version]?.link,target:"_blank",class:"official-link"},[...s[18]||(s[18]=[e("i",{class:"pi pi-globe"},null,-1),y(" Nota oficial ",-1)])],8,qs)):x("",!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),u(ls,{name:"fade"},{default:f(()=>[V.value?(t(),n("button",{key:0,onClick:Z,class:"scroll-top-button"},[...s[20]||(s[20]=[e("i",{class:"pi pi-arrow-up"},null,-1)])])):x("",!0)]),_:1})],64))}}),Os=is(Ds,[["__scopeId","data-v-026e8b0e"]]);export{Os as default};
