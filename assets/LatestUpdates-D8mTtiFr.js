import{A as e,M as t,U as n,d as r,dt as i,f as a,h as o,j as s,k as c,l,m as u,p as ee,st as d,t as te,tt as f,ut as ne,v as p,x as re,y as m}from"./runtime-dom.esm-bundler-DVzMal_p.js";import{t as h}from"./button-Bw1EBTQH.js";import"./portal-BI2jNyMm.js";import"./dist-BmVmG--T.js";import{t as ie}from"./ThemeSwitch-clVHOxw7.js";import"./baseinput-B4lj0bez.js";import"./inputtext-CdlTGRqd.js";import{t as ae}from"./dialog-BrZXZnva.js";import{t as g}from"./_plugin-vue_export-helper-D6098ZHW.js";import{t as _}from"./card-BdxbRywI.js";import"./minus-BzWp2jKH.js";import{t as oe}from"./panel-GWWEmbYa.js";import{t as v}from"./logo-white-CAp0XnaH.js";import{t as se}from"./tag-GvdDxJZh.js";import{t as ce}from"./inputnumber-BOky0a6f.js";import{a as le}from"./api-DnarUB0H.js";var ue={class:`space-page-container`},y={class:`flex items-start justify-between mb-6 header-container`},b={class:`flex flex-col`},x={class:`text-stellar-gray mt-2`},S={class:`mb-4 flex items-center gap-2`},C={class:`panel-content`},w={class:`update-info`},T={key:0,class:`loading-message`},E={key:1,class:`error-message p-error`},D={class:`p-4`},O={class:`flex flex-column gap-3`},k={class:`flex align-items-center gap-2`},A={class:`update-title`},j={class:`flex justify-between items-center mb-3`},M={class:`update-date`},N={class:`update-date-formatted`},P={key:0,class:`image-container`},F=[`src`,`alt`],I={class:`update-details`},L={class:`detail-item`},R={class:`detail-value`},z={key:0,class:`summary-box`},B={key:1,class:`fixes-box`},V={class:`fixes-preview`},H={class:`fix-text`},de={key:0,class:`fixes-actions`},fe={class:`dialog-content`},pe={class:`fixes-count`},me={class:`fixes-list-container`},he={class:`fix-number`},ge={class:`fix-content`},_e={class:`dialog-footer`},ve={class:`mt-3 flex justify-between`},ye=[`href`],be=[`href`],U=g(re({__name:`LatestUpdates`,setup(re){let g=r(()=>q.value.slice(0,K.value)),v=f({}),U=f(!0),W=f(null),G=f(window.innerWidth),K=f(10),q=f([]),J=f(!1),Y=f({}),xe=r(()=>G.value<768?1:G.value<1200?2:3),X=async()=>{try{let e=new URLSearchParams({action:`parse`,page:`Noticias`,prop:`text`,format:`json`,origin:`*`}),t=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${e.toString()}`)).json()).parse.text[`*`];Se(t)}catch(e){W.value=`Error al cargar las noticias`,console.error(e)}},Se=e=>{let t=new DOMParser,n=t.parseFromString(e,`text/html`).querySelector(`.plainlinks`);if(!n)return;let r=[],i=n.innerHTML.split(`<br>`);for(let e of i){if(!e.trim())continue;let n=t.parseFromString(e,`text/html`),i=n.querySelector(`a`);if(i){let e=i.textContent?.trim()||``,t=i.getAttribute(`href`)||``,a=decodeURIComponent(t.split(`/wiki/`).pop()||``).replace(/_/g,` `).match(/(\d+\.\d+(\.\d+)?)/),o=n.body.textContent?.match(/(\d{1,2} de [a-z]+ de \d{4})/i);a&&o&&r.push({title:e,link:`https://nomanssky.fandom.com${t}`,date:o[1],version:a[1]})}}q.value=r,Ce()},Ce=async()=>{try{for(let e of g.value){let t=await we(e.link);t&&(v.value[e.version]=t)}}catch(e){console.error(`Error fetching update details:`,e)}finally{U.value=!1}},we=async e=>{try{let t=e.split(`/wiki/`)[1],n=new URLSearchParams({action:`parse`,page:decodeURIComponent(t),prop:`wikitext`,format:`json`,origin:`*`}),r=(await(await fetch(`https://nomanssky.fandom.com/es/api.php?${n.toString()}`)).json()).parse.wikitext[`*`];return Z(r,t)}catch(t){return console.error(`Error fetching details for ${e}:`,t),{}}},Te=e=>(e=e.replace(/'''/g,``),e=e.replace(/''/g,``),e=e.replace(/\[\[([^\|\]]+)\|([^\]]+)\]\]/g,`$2`),e=e.replace(/\[\[([^\]]+)\]\]/g,`$1`),e=e.replace(/<br\s*\/?>/gi,`
`),e),Z=async(e,t)=>{let n={fixes:[]},r=e.match(/\|\s*image\s*=\s*(.+?)\n/);if(r){let e=await le(r[1].split(`
`)[0].split(`|`)[0].trim());e&&(n.image=e)}let i=e.match(/\|\s*date\s*=\s*(.+?)\n/);i&&(n.date=i[1].trim());let a=e.match(/\|\s*platform\s*=\s*(.+?)\n/);a&&(n.platforms=a[1].trim());let o=e.match(/\|\s*link\s*=\s*\[(https?:\/\/[^\s\]]+)(?:\s[^\]]*)?\]/);o&&(n.link=o[1].trim());let s=e.match(/==\s*Resumen\s*==\s*\n([\s\S]*?)(?=\n==|$)/);s&&(n.summary=Te(s[1].trim()));let c=e.match(/==\s*(?:corre(?:cci[oó]n(?:es)?\s+de\s+errores?|cciones\s+de\s+errores?)|notas?\s+del\s+parche)\s*==\s*\n([\s\S]*?)(?=\n==|$)/i);if(c){let e=c[1].matchAll(/^\*\s*(.+)$/gm);for(let t of e){let e=t[1].replace(/\s+/g,` `).trim();n.fixes?.push(e)}}return n};c(()=>{window.addEventListener(`resize`,()=>G.value=window.innerWidth),X()});let Ee=()=>{U.value=!0,W.value=null,q.value=[],v.value={},X()},Q=e=>{let t={enero:`01`,febrero:`02`,marzo:`03`,abril:`04`,mayo:`05`,junio:`06`,julio:`07`,agosto:`08`,septiembre:`09`,octubre:`10`,noviembre:`11`,diciembre:`12`},n=e.split(` de `);return n.length===3?`${n[0].padStart(2,`0`)}/${t[n[1].toLowerCase()]}/${n[2]}`:e},De=r(()=>g.value.length>0?Q(g.value[0].date):`N/A`),$=()=>{J.value=window.scrollY>300},Oe=()=>{window.scrollTo({top:0,behavior:`smooth`})};c(()=>{window.addEventListener(`scroll`,$)}),e(()=>{window.removeEventListener(`scroll`,$)});let ke=e=>{Y.value[e]=!0},Ae=e=>{Y.value[e]=!1};return(e,r)=>(s(),o(l,null,[m(d(_),{class:`p-0 galactic-card`},{content:n(()=>[a(`div`,ue,[a(`div`,y,[a(`div`,b,[r[1]||=a(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[a(`div`,{class:`wiki-logo`},[a(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`Wiki Logo`})])],-1),r[2]||=a(`div`,{class:`header-container`},[a(`div`,{class:`title-theme-container`},[a(`h1`,{class:`galactic-title`},[a(`span`,{class:`title-text`},`Actualizaciones de No Man's Sky`)])])],-1),r[3]||=a(`p`,{class:`text-stellar-gray mt-2`},`Últimas actualizaciones del juego desde la wiki oficial`,-1),a(`p`,x,[m(ie,{style:{"margin-right":`2rem`}})])])]),a(`div`,S,[r[4]||=a(`label`,{for:`maxUpdates`,class:`text-stellar-gray font-semibold`},`Mostrar hasta:`,-1),m(d(ce),{id:`maxUpdates`,modelValue:K.value,"onUpdate:modelValue":r[0]||=e=>K.value=e,min:1,max:15,showButtons:!0,inputClass:`p-inputtext-sm`,class:`mx-2`},null,8,[`modelValue`]),r[5]||=a(`span`,{class:`text-stellar-gray`},`actualizaciones`,-1),r[6]||=a(`br`,null,null,-1),r[7]||=a(`br`,null,null,-1),m(d(h),{label:`Buscar Actualizaciones`,icon:`pi pi-refresh`,class:`p-button-outlined p-button-sm`,onClick:Ee})]),m(d(oe),{class:`galactic-panel`},{header:n(()=>[...r[8]||=[a(`h2`,{class:`panel-title`},`Historial de Actualizaciones`,-1)]]),default:n(()=>[a(`div`,C,[a(`p`,null,[r[9]||=p(` Total de actualizaciones recientes: `,-1),a(`strong`,null,i(g.value.length),1)]),a(`p`,w,`Última actualización: `+i(De.value),1)])]),_:1}),r[19]||=a(`br`,null,null,-1),U.value?(s(),o(`div`,T,[...r[10]||=[a(`i`,{class:`pi pi-spinner pi-spin`},null,-1),p(` Cargando actualizaciones... `,-1)]])):W.value?(s(),o(`div`,E,[r[11]||=a(`i`,{class:`pi pi-exclamation-triangle`},null,-1),p(` `+i(W.value),1)])):(s(),o(`div`,{key:2,class:`grid gap-4`,style:ne(`grid-template-columns: repeat(${xe.value}, 1fr)`)},[(s(!0),o(l,null,t(g.value,(e,c)=>(s(),ee(d(_),{key:c,class:`update-card`},{content:n(()=>[a(`div`,D,[a(`div`,O,[a(`div`,k,[a(`h3`,A,i(e.title),1),m(d(se),{value:e.version,severity:`info`,class:`version-tag`},null,8,[`value`])]),a(`div`,j,[a(`span`,M,i(e.date),1),a(`span`,N,i(Q(e.date)),1)]),v.value[e.version]?.image?(s(),o(`div`,P,[a(`img`,{src:v.value[e.version]?.image?.panel,alt:e.title,class:`update-image`},null,8,F)])):u(``,!0),a(`div`,I,[a(`div`,L,[r[12]||=a(`span`,{class:`detail-label`},`Plataformas:`,-1),a(`span`,R,i(v.value[e.version]?.platforms||`Todas`),1)]),v.value[e.version]?.summary?(s(),o(`div`,z,[r[13]||=a(`span`,{class:`detail-label`},`Resumen:`,-1),a(`p`,null,i(v.value[e.version]?.summary),1)])):u(``,!0),v.value[e.version]?.fixes&&v.value[e.version]?.fixes.length>0?(s(),o(`div`,B,[r[16]||=a(`div`,{class:`fixes-header`},[a(`i`,{class:`pi pi-wrench fixes-icon`}),a(`span`,{class:`detail-label`},`Correcciones principales:`)],-1),a(`div`,V,[(s(!0),o(l,null,t(v.value[e.version]?.fixes?.slice(0,3),(e,t)=>(s(),o(`div`,{key:t,class:`fix-item`},[r[14]||=a(`div`,{class:`fix-bullet`},null,-1),a(`span`,H,i(e),1)]))),128))]),v.value[e.version]?.fixes.length>3?(s(),o(`div`,de,[m(d(h),{label:`Ver todas (${v.value[e.version]?.fixes.length})`,icon:`pi pi-list`,class:`p-button-text p-button-sm view-all-btn`,onClick:t=>ke(e.version)},null,8,[`label`,`onClick`])])):u(``,!0),m(d(ae),{visible:Y.value[e.version],"onUpdate:visible":t=>Y.value[e.version]=t,header:`Correcciones completas - Versión ${e.version}`,modal:``,closable:!1,dismissableMask:``,class:`fixes-dialog`,style:{width:`90vw`,maxWidth:`800px`}},{footer:n(()=>[a(`div`,_e,[m(d(h),{label:`Cerrar`,icon:`pi pi-times`,class:`p-button-outlined`,onClick:t=>Ae(e.version)},null,8,[`onClick`])])]),default:n(()=>[a(`div`,fe,[a(`div`,pe,[r[15]||=a(`i`,{class:`pi pi-info-circle`},null,-1),a(`span`,null,`Total de correcciones: `+i(v.value[e.version]?.fixes?.length),1)]),a(`div`,me,[(s(!0),o(l,null,t(v.value[e.version]?.fixes,(e,t)=>(s(),o(`div`,{key:t,class:`dialog-fix-item`},[a(`div`,he,i(t+1),1),a(`div`,ge,i(e),1)]))),128))])])]),_:2},1032,[`visible`,`onUpdate:visible`,`header`])])):u(``,!0),a(`div`,ve,[a(`a`,{href:e.link,target:`_blank`,class:`wiki-link`},[...r[17]||=[a(`i`,{class:`pi pi-book`},null,-1),p(` Ver en wiki `,-1)]],8,ye),v.value[e.version]?.link?(s(),o(`a`,{key:0,href:v.value[e.version]?.link,target:`_blank`,class:`official-link`},[...r[18]||=[a(`i`,{class:`pi pi-globe`},null,-1),p(` Nota oficial `,-1)]],8,be)):u(``,!0)])])])])]),_:2},1024))),128))],4))])]),_:1}),m(te,{name:`fade`},{default:n(()=>[J.value?(s(),o(`button`,{key:0,onClick:Oe,class:`scroll-top-button`},[...r[20]||=[a(`i`,{class:`pi pi-arrow-up`},null,-1)]])):u(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-5f0dda4a`]]);export{U as default};