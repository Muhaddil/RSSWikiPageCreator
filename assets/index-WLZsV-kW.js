const $=new Set,d=new WeakMap,T=new WeakMap,h=new WeakMap,N=new WeakMap,A=new WeakMap,S=new WeakMap,E=new WeakMap,y=new WeakMap,x=new WeakSet;let u,j=0,z=0;const w="__aa_tgt",B="__aa_del",_="__aa_new",F=t=>{const e=tt(t);e&&e.forEach(i=>et(i))},J=t=>{t.forEach(e=>{e.target===u&&K(),d.has(e.target)&&M(e.target)})};function q(t){const e=t.getBoundingClientRect(),i=u?.clientWidth||0,n=u?.clientHeight||0;return e.bottom<0||e.top>n||e.right<0||e.left>i}function X(t){const e=N.get(t);e?.disconnect();let i=d.get(t),n=0;const o=5;i||(i=C(t),d.set(t,i));const{offsetWidth:r,offsetHeight:s}=u,c=[i.top-o,r-(i.left+o+i.width),s-(i.top+o+i.height),i.left-o].map(f=>`${-1*Math.floor(f)}px`).join(" "),l=new IntersectionObserver(()=>{++n>1&&M(t)},{root:u,threshold:1,rootMargin:c});l.observe(t),N.set(t,l)}function M(t,e=!0){clearTimeout(y.get(t));const i=k(t),n=e?P(i)?500:i.duration:0;y.set(t,setTimeout(async()=>{const o=h.get(t);try{await o?.finished,d.set(t,C(t)),X(t)}catch{}},n))}function K(){clearTimeout(y.get(u)),y.set(u,setTimeout(()=>{$.forEach(t=>L(t,e=>Q(()=>M(e))))},100))}function Z(t){setTimeout(()=>{S.set(t,setInterval(()=>Q(M.bind(null,t)),2e3))},Math.round(2e3*Math.random()))}function Q(t){typeof requestIdleCallback=="function"?requestIdleCallback(()=>t()):requestAnimationFrame(()=>t())}let v;const U=typeof window<"u"&&"ResizeObserver"in window;U&&(u=document.documentElement,new MutationObserver(F),v=new ResizeObserver(J),window.addEventListener("scroll",()=>{z=window.scrollY,j=window.scrollX}),v.observe(u));function tt(t){return t.reduce((n,o)=>[...n,...Array.from(o.addedNodes),...Array.from(o.removedNodes)],[]).every(n=>n.nodeName==="#comment")?!1:t.reduce((n,o)=>{if(n===!1)return!1;if(o.target instanceof Element){if(R(o.target),!n.has(o.target)){n.add(o.target);for(let r=0;r<o.target.children.length;r++){const s=o.target.children.item(r);if(s){if(B in s)return!1;R(o.target,s),n.add(s)}}}if(o.removedNodes.length)for(let r=0;r<o.removedNodes.length;r++){const s=o.removedNodes[r];if(B in s)return!1;s instanceof Element&&(n.add(s),R(o.target,s),T.set(s,[o.previousSibling,o.nextSibling]))}}return n},new Set)}function R(t,e){!e&&!(w in t)?Object.defineProperty(t,w,{value:t}):e&&!(w in e)&&Object.defineProperty(e,w,{value:t})}function et(t){var e,i;const n=t.isConnected,o=d.has(t);n&&T.has(t)&&T.delete(t),((e=h.get(t))===null||e===void 0?void 0:e.playState)!=="finished"&&((i=h.get(t))===null||i===void 0||i.cancel()),_ in t?D(t):o&&n?ot(t):o&&!n?it(t):D(t)}function m(t){return Number(t.replace(/[^0-9.\-]/g,""))}function nt(t){let e=t.parentElement;for(;e;){if(e.scrollLeft||e.scrollTop)return{x:e.scrollLeft,y:e.scrollTop};e=e.parentElement}return{x:0,y:0}}function C(t){const e=t.getBoundingClientRect(),{x:i,y:n}=nt(t);return{top:e.top+n,left:e.left+i,width:e.width,height:e.height}}function G(t,e,i){let n=e.width,o=e.height,r=i.width,s=i.height;const a=getComputedStyle(t);if(a.getPropertyValue("box-sizing")==="content-box"){const l=m(a.paddingTop)+m(a.paddingBottom)+m(a.borderTopWidth)+m(a.borderBottomWidth),f=m(a.paddingLeft)+m(a.paddingRight)+m(a.borderRightWidth)+m(a.borderLeftWidth);n-=f,r-=f,o-=l,s-=l}return[n,r,o,s].map(Math.round)}function k(t){return w in t&&E.has(t[w])?E.get(t[w]):{duration:250,easing:"ease-in-out"}}function V(t){if(w in t)return t[w]}function Y(t){const e=V(t);return e?x.has(e):!1}function L(t,...e){e.forEach(i=>i(t,E.has(t)));for(let i=0;i<t.children.length;i++){const n=t.children.item(i);n&&e.forEach(o=>o(n,E.has(n)))}}function H(t){return Array.isArray(t)?t:[t]}function P(t){return typeof t=="function"}function ot(t){const e=d.get(t),i=C(t);if(!Y(t))return d.set(t,i);if(q(t)){d.set(t,i),X(t);return}let n;if(!e)return;const o=k(t);if(typeof o!="function"){let r=e.left-i.left,s=e.top-i.top;const a=e.left+e.width-(i.left+i.width);e.top+e.height-(i.top+i.height)==0&&(s=0),a==0&&(r=0);const[l,f,O,p]=G(t,e,i),g={transform:`translate(${r}px, ${s}px)`},b={transform:"translate(0, 0)"};l!==f&&(g.width=`${l}px`,b.width=`${f}px`),O!==p&&(g.height=`${O}px`,b.height=`${p}px`),n=t.animate([g,b],{duration:o.duration,easing:o.easing})}else{const[r]=H(o(t,"remain",e,i));n=new Animation(r),n.play()}h.set(t,n),d.set(t,i),n.addEventListener("finish",M.bind(null,t,!1),{once:!0})}function D(t){_ in t&&delete t[_];const e=C(t);d.set(t,e);const i=k(t);if(!Y(t))return;if(q(t)){X(t);return}let n;if(typeof i!="function")n=t.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:i.duration*1.5,easing:"ease-in"});else{const[o]=H(i(t,"add",e));n=new Animation(o),n.play()}h.set(t,n),n.addEventListener("finish",M.bind(null,t,!1),{once:!0})}function I(t,e){var i;t.remove(),d.delete(t),T.delete(t),h.delete(t),(i=N.get(t))===null||i===void 0||i.disconnect(),setTimeout(()=>{if(B in t&&delete t[B],Object.defineProperty(t,_,{value:!0,configurable:!0}),e&&t instanceof HTMLElement)for(const n in e)t.style[n]=""},0)}function it(t){var e;if(!T.has(t)||!d.has(t))return;const[i,n]=T.get(t);Object.defineProperty(t,B,{value:!0,configurable:!0});const o=window.scrollX,r=window.scrollY;if(n&&n.parentNode&&n.parentNode instanceof Element?n.parentNode.insertBefore(t,n):i&&i.parentNode?i.parentNode.appendChild(t):(e=V(t))===null||e===void 0||e.appendChild(t),!Y(t))return I(t);const[s,a,c,l]=st(t),f=k(t),O=d.get(t);(o!==j||r!==z)&&rt(t,o,r,f);let p,g={position:"absolute",top:`${s}px`,left:`${a}px`,width:`${c}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!P(f))Object.assign(t.style,g),p=t.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:f.duration,easing:"ease-out"});else{const[b,W]=H(f(t,"remove",O));W?.styleReset!==!1&&(g=W?.styleReset||g,Object.assign(t.style,g)),p=new Animation(b),p.play()}h.set(t,p),p.addEventListener("finish",()=>I(t,g),{once:!0})}function rt(t,e,i,n){const o=j-e,r=z-i,s=document.documentElement.style.scrollBehavior;if(getComputedStyle(u).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+o,window.scrollY+r),!t.parentElement)return;const c=t.parentElement;let l=c.clientHeight,f=c.clientWidth;const O=performance.now();function p(){requestAnimationFrame(()=>{if(!P(n)){const g=l-c.clientHeight,b=f-c.clientWidth;O+n.duration>performance.now()?(window.scrollTo({left:window.scrollX-b,top:window.scrollY-g}),l=c.clientHeight,f=c.clientWidth,p()):document.documentElement.style.scrollBehavior=s}})}p()}function st(t){var e;const i=d.get(t),[n,,o]=G(t,i,C(t));let r=t.parentElement;for(;r&&(getComputedStyle(r).position==="static"||r instanceof HTMLBodyElement);)r=r.parentElement;r||(r=document.body);const s=getComputedStyle(r),a=!h.has(t)||((e=h.get(t))===null||e===void 0?void 0:e.playState)==="finished"?C(r):d.get(r),c=Math.round(i.top-a.top)-m(s.borderTopWidth),l=Math.round(i.left-a.left)-m(s.borderLeftWidth);return[c,l,n,o]}function at(t,e={}){if(U&&v&&!(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!P(e)&&!e.disrespectUserMotionPreference)){x.add(t),getComputedStyle(t).position==="static"&&Object.assign(t.style,{position:"relative"}),L(t,M,Z,s=>v?.observe(s)),P(e)?E.set(t,e):E.set(t,{duration:250,easing:"ease-in-out",...e});const r=new MutationObserver(F);r.observe(t,{childList:!0}),A.set(t,r),$.add(t)}return Object.freeze({parent:t,enable:()=>{x.add(t)},disable:()=>{x.delete(t),L(t,n=>{const o=h.get(n);try{o?.cancel()}catch{}h.delete(n);const r=y.get(n);r&&clearTimeout(r),y.delete(n);const s=S.get(n);s&&clearInterval(s),S.delete(n)})},isEnabled:()=>x.has(t),destroy:()=>{x.delete(t),$.delete(t),E.delete(t);const n=A.get(t);n?.disconnect(),A.delete(t),L(t,o=>{v?.unobserve(o);const r=h.get(o);try{r?.cancel()}catch{}h.delete(o);const s=N.get(o);s?.disconnect(),N.delete(o);const a=S.get(o);a&&clearInterval(a),S.delete(o);const c=y.get(o);c&&clearTimeout(c),y.delete(o),d.delete(o),T.delete(o)})}})}export{at as a};
