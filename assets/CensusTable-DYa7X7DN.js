import{A as e,M as t,U as n,d as r,dt as i,f as a,h as o,j as s,k as c,l,m as u,p as d,st as f,t as ee,tt as p,ut as te,v as m,x as ne,y as h}from"./runtime-dom.esm-bundler-DVzMal_p.js";import{t as g}from"./button-CVz193gd.js";import"./baseinput--BA165k7.js";import{t as re}from"./inputtext-CiYZwUyJ.js";import{t as _}from"./_plugin-vue_export-helper-D6098ZHW.js";import{t as v}from"./card-BbvSSszV.js";import{t as y}from"./panel-VofabEHw.js";import{t as b}from"./logo-white-CAp0XnaH.js";import{t as x}from"./tag-Bbuupr0i.js";import{t as ie}from"./paginator-D_JMB0Eq.js";import{t as S}from"./dropdown-afQjlgEP.js";import{n as ae,t as oe}from"./api-DnarUB0H.js";var se={class:`space-page-container`},ce={class:`filter-container mb-6`},le={class:`filter-row`},ue={class:`year-filter`},de={class:`input-group`},fe={class:`pagination-filter`},pe={key:0,class:`rows-filter`},me={class:`flex justify-between items-center mt-3`},he={key:0,class:`filter-info`},ge={class:`info-text`},_e={class:`flex`},C={class:`panel-content`},w={key:0,class:`storage-indicator`},T={class:`security-level mt-2`},E={class:`update-info`},D={key:1,class:`loading-message`},O={key:2,class:`error-message p-error`},k={key:3,class:`empty-message`},A={class:`p-4 base-content`},j={class:`flex flex-column gap-3`},M={class:`flex align-items-center gap-2`},N={class:`base-title`},P={class:`base-details`},F={class:`detail-item`},I={class:`detail-value`},ve={class:`detail-item`},ye={class:`detail-value`},be={class:`flex gap-2`},xe={class:`panel-content-with-image`},Se=[`href`],Ce=[`src`,`onClick`],L=3e4,we=`Royal Space Society`,R=_(ne({__name:`CensusTable`,setup(ne){let _={BASES:`rss_census_bases`,LAST_FETCH:`rss_last_fetch_timestamp`,YEAR_FILTER:`rss_year_filter`},b=p([]),R=p(!0),z=p(null),B=p(window.innerWidth),V=p(``),H=p(!0),U=p(0),W=p(12),G=p(!1),K=p(!0),q=p(0),Te=[{label:`6 por página`,value:6},{label:`12 por página`,value:12},{label:`27 por página`,value:27},{label:`48 por página`,value:48}],Ee=r(()=>H.value?b.value.slice(U.value,U.value+W.value):b.value),De=[{label:`Sí, usar paginación`,value:!0},{label:`No, mostrar todo`,value:!1}],Oe=r(()=>B.value<768?1:B.value<1200?2:3),J=()=>{try{let e=localStorage.getItem(_.BASES),t=localStorage.getItem(_.LAST_FETCH);if(e&&(b.value=JSON.parse(e)),V.value=``,t){let e=Date.now()-parseInt(t);e<L&&(K.value=!1,Y(L-e))}}catch(e){console.error(`Error loading from localStorage:`,e)}},ke=()=>{try{V.value||(localStorage.setItem(_.BASES,JSON.stringify(b.value)),localStorage.setItem(_.LAST_FETCH,Date.now().toString()))}catch(e){console.error(`Error saving to localStorage:`,e)}},Y=e=>{K.value=!1,q.value=Math.ceil(e/1e3);let t=setInterval(()=>{q.value--,q.value<=0&&(clearInterval(t),K.value=!0,q.value=0)},1e3)},X=async(e=0,t)=>{try{let n=await ae(we,e,t),r=n;await Promise.all(r.map(async e=>{try{e.imageUrl=await oe(e._pageName)}catch{console.warn(`No se pudo cargar imagen para ${e._pageName}`),e.imageUrl=null}})),e===0?b.value=n:b.value=[...b.value,...n],ke(),n.length===500&&await X(e+500,t)}catch(e){z.value=`Error al cargar las bases`,console.error(e)}finally{R.value=!1}},Z=async()=>{if(!K.value){z.value=`Espera ${q.value} segundos antes de actualizar`;return}b.value=[],R.value=!0,z.value=null,Y(L),await X(0,V.value)};c(async()=>{window.addEventListener(`resize`,()=>B.value=window.innerWidth),window.addEventListener(`scroll`,$),R.value=!0,J(),(b.value.length===0||K.value)&&await X(0),R.value=!1});let Q=e=>e.trim().replace(/\s+/g,`_`).replace(/\//g,`_`),Ae=e=>{window.open(e,`_blank`)},je=()=>{U.value=0},$=()=>{G.value=window.scrollY>300},Me=()=>{window.scrollTo({top:0,behavior:`smooth`})};return c(()=>{window.addEventListener(`scroll`,$)}),e(()=>{window.removeEventListener(`scroll`,$)}),(e,r)=>(s(),o(l,null,[h(f(v),{class:`p-0 galactic-card`},{content:n(()=>[a(`div`,se,[r[23]||=a(`div`,{class:`flex items-start justify-between mb-6 header-container`},[a(`div`,{class:`flex flex-col`},[a(`a`,{href:`https://nomanssky.fandom.com/es/wiki/Royal_Space_Society`,target:`_blank`},[a(`div`,{class:`rss-logo`},[a(`img`,{src:`/RSSWikiPageCreator/assets/images/shared/logo-white.png`,class:`logo-image`,alt:`RSS Logo`})])]),a(`div`,{class:`header-container`},[a(`div`,{class:`title-theme-container`},[a(`h1`,{class:`galactic-title`},[a(`span`,{class:`title-text`},`Censo de Bases - Royal Space Society`)])])]),a(`p`,{class:`text-stellar-gray mt-2`},`Explora las bases espaciales de la Royal Space Society`)])],-1),a(`div`,ce,[a(`div`,le,[a(`div`,ue,[r[4]||=a(`label`,{for:`yearInput`,class:`filter-label`},[a(`i`,{class:`pi pi-calendar mr-2`}),m(` Año del censo: `)],-1),a(`div`,de,[h(f(re),{id:`yearInput`,type:`number`,modelValue:V.value,"onUpdate:modelValue":r[0]||=e=>V.value=e,placeholder:`Ej. 2023`,class:`year-input`},null,8,[`modelValue`]),h(f(g),{onClick:Z,icon:`pi pi-search`,label:`Filtrar`,class:`filter-btn`,loading:R.value,disabled:!K.value},null,8,[`loading`,`disabled`])])]),a(`div`,fe,[r[5]||=a(`label`,{class:`filter-label`},[a(`i`,{class:`pi pi-list mr-2`}),m(` Paginación: `)],-1),h(f(S),{modelValue:H.value,"onUpdate:modelValue":r[1]||=e=>H.value=e,options:De,optionLabel:`label`,optionValue:`value`,class:`pagination-dropdown`},null,8,[`modelValue`])]),H.value?(s(),o(`div`,pe,[r[6]||=a(`label`,{class:`filter-label`},[a(`i`,{class:`pi pi-th-large mr-2`}),m(` Elementos: `)],-1),h(f(S),{modelValue:W.value,"onUpdate:modelValue":r[2]||=e=>W.value=e,options:Te,optionLabel:`label`,optionValue:`value`,class:`rows-dropdown`,onChange:je},null,8,[`modelValue`])])):u(``,!0)]),a(`div`,me,[b.value.length>0?(s(),o(`div`,he,[a(`span`,ge,[r[7]||=a(`i`,{class:`pi pi-database mr-1`},null,-1),m(` Total: `+i(b.value.length)+` bases `,1),r[8]||=a(`i`,{class:`pi pi-cloud ml-2 mr-1`},null,-1),r[9]||=a(`span`,null,`(Guardadas localmente)`,-1)])])):u(``,!0),a(`div`,_e,[h(f(g),{onClick:Z,icon:`pi pi-refresh`,label:`Actualizar`,class:`update-btn mr-2 mt-2 last:mr-0 last:mt-0`,loading:R.value,disabled:!K.value,severity:`help`},null,8,[`loading`,`disabled`]),K.value?u(``,!0):(s(),d(f(g),{key:0,label:`Esperar ${q.value}s`,class:`cooldown-btn last:mr-0 last:mt-0`,severity:`secondary`,disabled:``},null,8,[`label`]))])])]),H.value&&b.value.length>W.value?(s(),d(f(ie),{key:0,first:U.value,rows:W.value,totalRecords:b.value.length,onPage:r[3]||=e=>{U.value=e.first,W.value=e.rows},class:`mb-4`},null,8,[`first`,`rows`,`totalRecords`])):u(``,!0),h(f(y),{class:`galactic-panel mt-6`},{header:n(()=>[...r[10]||=[a(`h2`,{class:`panel-title`},`Información del Censo`,-1)]]),default:n(()=>[a(`div`,C,[a(`p`,null,[r[12]||=m(` Total de bases registradas: `,-1),a(`strong`,null,i(b.value.length),1),b.value.length>0?(s(),o(`span`,w,[...r[11]||=[a(`i`,{class:`pi pi-cloud ml-2`},null,-1),m(` Datos en cache `,-1)]])):u(``,!0)]),a(`p`,T,[r[13]||=m(` Nivel de seguridad: `,-1),h(f(x),{value:`Clasificado RSS`,severity:`info`,class:`category-tag`})]),a(`p`,E,[m(` Última actualización: `+i(new Date().toLocaleDateString())+` `,1),r[14]||=a(`br`,null,null,-1),r[15]||=a(`small`,null,`Límite API: 2 consultas por minuto`,-1)])])]),_:1}),r[24]||=a(`br`,null,null,-1),R.value?(s(),o(`div`,D,[...r[16]||=[a(`i`,{class:`pi pi-spinner pi-spin`},null,-1),m(` Cargando bases espaciales... `,-1)]])):z.value?(s(),o(`div`,O,[r[17]||=a(`i`,{class:`pi pi-exclamation-triangle`},null,-1),m(` `+i(z.value),1)])):b.value.length===0?(s(),o(`div`,k,[...r[18]||=[a(`i`,{class:`pi pi-info-circle`},null,-1),m(` No se encontraron bases `,-1)]])):(s(),o(`div`,{key:4,class:`grid gap-4`,style:te(`grid-template-columns: repeat(${Oe.value}, 1fr)`)},[(s(!0),o(l,null,t(Ee.value,(e,t)=>(s(),d(f(v),{key:t,class:`link-card`},{content:n(()=>[a(`div`,A,[a(`div`,j,[a(`div`,M,[a(`h3`,N,i(e.Name),1),h(f(x),{value:e.Platform,severity:`info`,class:`category-tag`},null,8,[`value`])]),a(`div`,P,[a(`div`,F,[r[19]||=a(`span`,{class:`detail-label`},`Jugador:`,-1),a(`span`,I,i(e.CensusPlayer),1)]),a(`div`,ve,[r[20]||=a(`span`,{class:`detail-label`},`Sistema:`,-1),a(`span`,ye,i(e.System),1)]),a(`div`,be,[h(f(x),{value:e.Mode,severity:`success`,class:`category-tag`},null,8,[`value`]),h(f(x),{value:`Llegada: ${e.CensusArrival}`,severity:`warning`,class:`category-tag`},null,8,[`value`]),h(f(x),{value:`Renovación: ${e.CensusRenewal}`,severity:`danger`,class:`category-tag`},null,8,[`value`])])]),e.Name?(s(),d(f(y),{key:0,class:`builder-panel mt-3`},{header:n(()=>[...r[21]||=[a(`span`,{class:`builder-link-header`},`Enlaces de la Base`,-1)]]),default:n(()=>[a(`div`,xe,[a(`a`,{href:`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`,target:`_blank`,class:`builder-link`},[...r[22]||=[a(`i`,{class:`pi pi-external-link`},null,-1),m(` Ver detalles de construcción `,-1)]],8,Se),e.imageUrl?(s(),o(`img`,{key:0,src:e.imageUrl.panel,alt:`Imagen de la base`,class:`panel-base-image`,onClick:t=>Ae(`https://nomanssky.fandom.com/wiki/${Q(e._pageName)}`)},null,8,Ce)):u(``,!0)])]),_:2},1024)):u(``,!0)])])]),_:2},1024))),128))],4))])]),_:1}),h(ee,{name:`fade`},{default:n(()=>[G.value?(s(),o(`button`,{key:0,onClick:Me,class:`scroll-top-button`},[...r[25]||=[a(`i`,{class:`pi pi-arrow-up`},null,-1)]])):u(``,!0)]),_:1})],64))}}),[[`__scopeId`,`data-v-9de8699d`]]);export{R as default};